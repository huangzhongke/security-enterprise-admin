"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils/methods/xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_cell=_interopRequireDefault(require("../../cell")),_vXETable=_interopRequireDefault(require("../../v-x-e-table")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}var browse=_tools.DomTools.browse,isWebkit=browse["-webkit"]&&!browse.edge,debounceScrollYDuration=browse.msie?40:20,resizableStorageKey="VXE_TABLE_CUSTOM_COLUMN_WIDTH",visibleStorageKey="VXE_TABLE_CUSTOM_COLUMN_VISIBLE";function getRowUniqueId(){return _xeUtils.default.uniqueId("row_")}function getNextSortOrder(e,t){var o=e.sortOpts.orders,i=t.order||null,r=o.indexOf(i)+1;return o[r<o.length?r:0]}function getCustomStorageMap(e){var t=_conf.default.version,o=_xeUtils.default.toStringJSON(localStorage.getItem(e));return o&&o._v===t?o:{_v:t}}function handleReserveRow(e,t){var o=e.fullAllDataRowMap;return t.filter(function(e){return o.has(e)})}var Methods={getParentElem:function(){return this.$xegrid?this.$xegrid.$el.parentNode:this.$el.parentNode},getParentHeight:function(){return this.$xegrid?this.$xegrid.getParentHeight():this.getParentElem().clientHeight},getExcludeHeight:function(){return this.$xegrid?this.$xegrid.getExcludeHeight():0},clearAll:function(){return this.inited=!1,this.clearSort(),this.clearCurrentRow(),this.clearCurrentColumn(),this.clearRadioRow(),this.clearRadioReserve(),this.clearCheckboxRow(),this.clearCheckboxReserve(),this.clearRowExpand(),this.clearTreeExpand(),_vXETable.default._edit&&this.clearActived(),_vXETable.default._filter&&this.clearFilter(),(this.keyboardConfig||this.mouseConfig)&&(this.clearIndexChecked(),this.clearHeaderChecked(),this.clearChecked(),this.clearSelected(),this.clearCopyed()),this.clearScroll()},refreshData:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["refreshData","syncData"]),this.syncData()},syncData:function(){var e=this;return this.$nextTick().then(function(){return e.tableData=[],e.$nextTick().then(function(){return e.loadTableData(e.tableFullData)})})},updateData:function(){return this.handleTableData(!0).then(this.updateFooter).then(this.recalculate)},handleTableData:function(e){var t=this.scrollYLoad,o=this.scrollYStore,i=e?this.updateAfterFullData():this.afterFullData;return this.tableData=t?i.slice(o.startIndex,Math.max(o.startIndex+o.renderSize,1)):i.slice(0),this.$nextTick()},loadTableData:function(e){var t=this,o=this.keepSource,i=this.treeConfig,r=this.editStore,l=this.sYOpts,n=this.scrollYStore,s=e?e.slice(0):[],a=!i&&-1<l.gt&&l.gt<s.length;return n.startIndex=0,n.visibleIndex=0,r.insertList=[],r.removeList=[],this.tableFullData=s,this.updateCache(!0),this.tableSynchData=e,o&&(this.tableSourceData=_xeUtils.default.clone(s,!0)),(this.scrollYLoad=a)&&(this.height||this.maxHeight||_tools.UtilTools.error("vxe.error.reqProp",["height | max-height"]),this.showOverflow||_tools.UtilTools.warn("vxe.error.reqProp",["show-overflow"]),this.spanMethod&&_tools.UtilTools.warn("vxe.error.scrollErrProp",["span-method"])),this.handleTableData(!0),this.updateFooter(),this.computeScrollLoad().then(function(){return t.isLoadData=!0,t.computeRowHeight(),t.handleReserveStatus(),t.checkSelectionStatus(),t.$nextTick().then(t.recalculate).then(t.refreshScroll)})},loadData:function(e){return this.inited=!0,this.loadTableData(e).then(this.recalculate)},reloadData:function(e){var t=this;return this.clearAll().then(function(){return t.inited=!0,t.loadTableData(e)}).then(this.handleDefaults)},reloadRow:function(e,t,o){var i=this.tableSourceData,r=this.tableData;if(!this.keepSource)return _tools.UtilTools.warn("vxe.error.reqProp",["keep-source"]),this.$nextTick();var l=this.getRowIndex(e),n=i[l];return n&&e&&(o?_xeUtils.default.set(n,o,_xeUtils.default.get(t||e,o)):t?(i[l]=t,_xeUtils.default.clear(e,void 0),Object.assign(e,this.defineField(Object.assign({},t))),this.updateCache(!0)):_xeUtils.default.destructuring(n,_xeUtils.default.clone(e,!0))),this.tableData=r.slice(0),this.$nextTick()},loadColumn:function(e){var t=this;return this.collectColumn=_xeUtils.default.mapTree(e,function(e){return _cell.default.createColumn(t,e)}),this.$nextTick()},reloadColumn:function(e){return this.clearAll(),this.loadColumn(e)},updateCache:function(r){var l=this,n=this.treeConfig,s=this.treeOpts,e=this.tableFullData,a=this.fullDataRowMap,c=this.fullAllDataRowMap,h=this.fullDataRowIdData,u=this.fullAllDataRowIdData,d=_tools.UtilTools.getRowkey(this),f=n&&s.lazy,t=function(e,t){var o=_tools.UtilTools.getRowid(l,e);o||(o=getRowUniqueId(),_xeUtils.default.set(e,d,o)),f&&e[s.hasChild]&&_xeUtils.default.isUndefined(e[s.children])&&(e[s.children]=null);var i={row:e,rowid:o,index:n?-1:t};r&&(h[o]=i,a.set(e,i)),u[o]=i,c.set(e,i)};r&&(h=this.fullDataRowIdData={},a.clear()),u=this.fullAllDataRowIdData={},c.clear(),n?_xeUtils.default.eachTree(e,t,s):e.forEach(t)},appendTreeCache:function(e,t){var o,r=this,i=this.keepSource,l=this.tableSourceData,n=this.treeOpts,s=this.fullDataRowIdData,a=this.fullDataRowMap,c=this.fullAllDataRowMap,h=this.fullAllDataRowIdData,u=n.children,d=n.hasChild,f=_tools.UtilTools.getRowkey(this),g=_tools.UtilTools.getRowid(this,e);i&&(o=_xeUtils.default.findTree(l,function(e){return g===_tools.UtilTools.getRowid(r,e)},n)),_xeUtils.default.eachTree(t,function(e,t){var o=_tools.UtilTools.getRowid(r,e);o||(o=getRowUniqueId(),_xeUtils.default.set(e,f,o)),e[d]&&_xeUtils.default.isUndefined(e[u])&&(e[u]=null);var i={row:e,rowid:o,index:t};s[o]=i,a.set(e,i),h[o]=i,c.set(e,i)},n),o&&(o.item[u]=_xeUtils.default.clone(t,!0))},cacheColumnMap:function(){var s,a,e=this.isGroup,t=this.tableFullColumn,o=this.collectColumn,c=this.fullColumnMap,h=this.fullColumnIdData={},u=this.fullColumnFieldData={},n=function(e,t){var o=e.id,i=e.property,r=e.fixed,l=e.type,n={column:e,colid:o,index:t};i&&(u[i]=n),!a&&r&&(a=r),s||"expand"!==l||(s=e),h[o]=n,c.set(e,n)};c.clear(),e?_xeUtils.default.eachTree(o,function(e,t,o,i,r,l){e.level=l.length,n(e,t)}):t.forEach(n),a&&s&&_tools.UtilTools.warn("vxe.error.errConflicts",["column.fixed","column.type=expand"]),this.expandColumn=s},getRowNode:function(e){var t=this;if(e){var o=this.treeConfig,i=this.treeOpts,r=this.tableFullData,l=this.fullAllDataRowIdData,n=e.getAttribute("data-rowid");if(o){var s=_xeUtils.default.findTree(r,function(e){return _tools.UtilTools.getRowid(t,e)===n},i);if(s)return s}else if(l[n]){var a=l[n];return{item:a.row,index:a.index,items:r}}}return null},getColumnNode:function(e){if(e){var t=this.fullColumnIdData,o=this.tableFullColumn,i=t[e.getAttribute("data-colid")];return{item:i.column,index:i.index,items:o}}return null},getRowIndex:function(e){return this.fullDataRowMap.has(e)?this.fullDataRowMap.get(e).index:-1},_getRowIndex:function(e){return this.afterFullData.indexOf(e)},$getRowIndex:function(e){return this.tableData.indexOf(e)},getColumnIndex:function(e){return this.fullColumnMap.has(e)?this.fullColumnMap.get(e).index:-1},_getColumnIndex:function(e){return this.visibleColumn.indexOf(e)},$getColumnIndex:function(e){return this.tableColumn.indexOf(e)},isSeqColumn:function(e){return e&&("seq"===e.type||"index"===e.type)},defineField:function(i){var e=this.treeConfig,t=this.treeOpts,o=_tools.UtilTools.getRowkey(this);return this.visibleColumn.forEach(function(e){var t=e.property,o=e.editRender;t&&!_xeUtils.default.has(i,t)&&_xeUtils.default.set(i,t,o&&!_xeUtils.default.isUndefined(o.defaultValue)?o.defaultValue:null)}),e&&t.lazy&&_xeUtils.default.isUndefined(i[t.children])&&(i[t.children]=null),_xeUtils.default.get(i,o)||_xeUtils.default.set(i,o,getRowUniqueId()),i},createData:function(e){var t=this,o=_tools.UtilTools.getRowkey(this),i=e.map(function(e){return t.defineField(Object.assign({},e,_defineProperty({},o,null)))});return this.$nextTick().then(function(){return i})},createRow:function(e){var t=this,o=_xeUtils.default.isArray(e);return o||(e=[e]),this.$nextTick().then(function(){return t.createData(e).then(function(e){return o?e:e[0]})})},revert:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["revert","revertData"]),this.revertData.apply(this,arguments)},revertData:function(e,i){var r=this,l=this.tableSourceData,n=this.tableFullData;return this.keepSource?arguments.length?(e&&!_xeUtils.default.isArray(e)&&(e=[e]),e.forEach(function(e){if(!r.isInsertByRow(e)){var t=n.indexOf(e),o=l[t];o&&e&&(i?_xeUtils.default.set(e,i,_xeUtils.default.clone(_xeUtils.default.get(o,i),!0)):_xeUtils.default.destructuring(e,_xeUtils.default.clone(o,!0)))}}),this.$nextTick()):this.reloadData(l):(_tools.UtilTools.warn("vxe.error.reqProp",["keep-source"]),this.$nextTick())},clearData:function(e,t){var o=this.tableFullData,i=this.visibleColumn;return arguments.length?e&&!_xeUtils.default.isArray(e)&&(e=[e]):e=o,t?e.forEach(function(e){return _xeUtils.default.set(e,t,null)}):e.forEach(function(t){i.forEach(function(e){e.property&&_tools.UtilTools.setCellValue(t,e,null)})}),this.$nextTick()},isInsertByRow:function(e){return-1<this.editStore.insertList.indexOf(e)},hasRowChange:function(e,t){return _tools.UtilTools.warn("vxe.error.delFunc",["hasRowChange","isUpdateByRow"]),this.isUpdateByRow(e,t)},isUpdateByRow:function(e,t){var o=this,i=this.visibleColumn,r=this.keepSource,l=this.treeConfig,n=this.treeOpts,s=this.tableSourceData,a=this.fullDataRowIdData;if(r){var c,h,u=_tools.UtilTools.getRowid(this,e);if(!a[u])return!1;if(l){var d=n.children,f=_xeUtils.default.findTree(s,function(e){return u===_tools.UtilTools.getRowid(o,e)},n);e=Object.assign({},e,_defineProperty({},d,null)),f&&(c=Object.assign({},f.item,_defineProperty({},d,null)))}else{c=s[a[u].index]}if(c){if(1<arguments.length)return!_xeUtils.default.isEqual(_xeUtils.default.get(c,t),_xeUtils.default.get(e,t));for(var g=0,x=i.length;g<x;g++)if((h=i[g].property)&&!_xeUtils.default.isEqual(_xeUtils.default.get(c,h),_xeUtils.default.get(e,h)))return!0}}return!1},getColumns:function(e){var t=this.visibleColumn;return arguments.length?t[e]:t.slice(0)},getColumnById:function(e){var t=this.fullColumnIdData;return t[e]?t[e].column:null},getColumnByField:function(e){var t=this.fullColumnFieldData;return t[e]?t[e].column:null},getTableColumn:function(){return{collectColumn:this.collectColumn.slice(0),fullColumn:this.tableFullColumn.slice(0),visibleColumn:this.visibleColumn.slice(0),tableColumn:this.tableColumn.slice(0)}},getRecords:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getRecords","getData"]),this.getData.apply(this,arguments)},getData:function(e){var t=this.data||this.tableSynchData;return arguments.length?t[e]:t.slice(0)},getAllRecords:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getAllRecords","getRecordset"]),this.getRecordset()},getSelectRecords:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getSelectRecords","getCheckboxRecords"]),this.getCheckboxRecords()},getCheckboxRecords:function(){var e=this.tableFullData,t=this.treeConfig,o=this.treeOpts,i=this.checkboxOpts.checkField,r=[];if(i)r=t?_xeUtils.default.filterTree(e,function(e){return _xeUtils.default.get(e,i)},o):e.filter(function(e){return _xeUtils.default.get(e,i)});else{var l=this.selection;r=t?_xeUtils.default.filterTree(e,function(e){return-1<l.indexOf(e)},o):e.filter(function(e){return-1<l.indexOf(e)})}return r},updateAfterFullData:function(){var e=this.visibleColumn,t=this.tableFullData,o=this.remoteSort,h=this.remoteFilter,u=this.filterOpts,i=this.sortOpts,r=t.slice(0),l=_xeUtils.default.find(e,function(e){return e.order}),n=[];if(e.forEach(function(e){if(e.filters&&e.filters.length){var t=[],o=[];e.filters.forEach(function(e){e.checked&&(o.push(e),t.push(e.value))}),n.push({column:e,valueList:t,itemList:o})}}),n.length&&(r=r.filter(function(c){return n.every(function(e){var t=e.column,o=e.valueList,i=e.itemList;if(!o.length||u.remote||h)return!0;var r=t.filterRender,l=t.property,n=t.filterMethod,s=u.filterMethod,a=r?_vXETable.default.renderer.get(r.name):null;return!n&&a&&a.renderFilter&&(n=a.filterMethod),s&&!n?s({options:i,values:o,row:c,column:t}):n?i.some(function(e){return n({value:e.value,option:e,row:c,column:t})}):-1<o.indexOf(_xeUtils.default.get(c,l))})})),l&&l.order){var s=i.sortMethod||this.sortMethod;if(!(_xeUtils.default.isBoolean(l.remoteSort)?l.remoteSort:i.remote||o))if(s)r=s({data:r,column:l,property:l.property,order:l.order,$table:this})||r;else{var a={$table:this},c=l.sortMethod?r.sort(l.sortMethod):_xeUtils.default.sortBy(r,l.sortBy||(l.formatter?function(e){return _tools.UtilTools.getCellLabel(e,l,a)}:l.property));r="desc"===l.order?c.reverse():c}}return this.afterFullData=r},getRowById:function(e){var t=this.fullDataRowIdData;return t[e]?t[e].row:null},getRowid:function(e){var t=this.fullAllDataRowMap;return t.has(e)?t.get(e).rowid:null},getTableData:function(){var e=this.tableFullData,t=this.afterFullData,o=this.tableData,i=this.footerData;return{fullData:e.slice(0),visibleData:t.slice(0),tableData:o.slice(0),footerData:i.slice(0)}},handleDefaults:function(){var e=this;(this.checkboxConfig||this.selectConfig)&&this.handleDefaultSelectionChecked(),this.radioConfig&&this.handleDefaultRadioChecked(),this.sortConfig&&this.handleDefaultSort(),this.expandConfig&&this.handleDefaultRowExpand(),this.treeConfig&&this.handleDefaultTreeExpand(),this.$nextTick(function(){return setTimeout(e.recalculate)})},mergeCustomColumn:function(o){var e=this.tableFullColumn;this.isUpdateCustoms=!0,o.length&&e.forEach(function(t){var e=_xeUtils.default.find(o,function(e){return t.property&&(e.field||e.prop)===t.property});e&&(_xeUtils.default.isNumber(e.resizeWidth)&&(t.resizeWidth=e.resizeWidth),_xeUtils.default.isBoolean(e.visible)&&(t.visible=e.visible))}),this.emitEvent("update:customs",e)},resetAll:function(){_tools.UtilTools.warn("vxe.error.delFunc",["resetAll","resetColumn"]),this.resetColumn(!0)},hideColumn:function(e){return e.visible=!1,this.handleCustom()},showColumn:function(e){return e.visible=!0,this.handleCustom()},resetColumn:function(e){var t=this.customOpts.checkMethod,o=Object.assign({visible:!0,resizable:!0===e},e);return this.tableFullColumn.forEach(function(e){o.resizable&&(e.resizeWidth=0),t&&!t({column:e})||(e.visible=e.defaultVisible)}),o.resizable&&this.saveCustomResizable(!0),this.handleCustom()},handleCustom:function(){return this.saveCustomVisible(),this.analyColumnWidth(),this.refreshColumn()},resetResizable:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["resetResizable","resetColumn"]),this.resetColumn()},reloadCustoms:function(e){var t=this;return _tools.UtilTools.warn("vxe.error.delFunc",["reloadCustoms","column.visible & refreshColumn"]),this.$nextTick().then(function(){return t.mergeCustomColumn(e),t.refreshColumn().then(function(){return t.tableFullColumn})})},restoreCustomStorage:function(){var e=this.$toolbar,t=this.collectColumn,o=this.customConfig,i=this.customOpts,r=i.storage,l=!0===i.storage,n=l||r&&r.resizable||e&&e.resizableOpts.storage,s=l||r&&r.visible||e&&e.customOpts.storage;if((o||e)&&(n||s)){var a=o?this.id:e?e.id:null,c={};if(!a)return void _tools.UtilTools.error("vxe.error.reqProp",["id"]);if(n){var h=getCustomStorageMap(resizableStorageKey)[a];h&&_xeUtils.default.each(h,function(e,t){c[t]={field:t,resizeWidth:e}})}if(s){var u=getCustomStorageMap(visibleStorageKey)[a];if(u){var d=u.split("|"),f=d[0]?d[0].split(","):[],g=d[1]?d[1].split(","):[];f.forEach(function(e){c[e]?c[e].visible=!1:c[e]={field:e,visible:!1}}),g.forEach(function(e){c[e]?c[e].visible=!0:c[e]={field:e,visible:!0}})}}var x={};_xeUtils.default.eachTree(t,function(e){var t=e.getKey();t&&(x[t]=e)}),_xeUtils.default.each(c,function(e,t){var o=e.visible,i=e.resizeWidth,r=x[t];r&&(_xeUtils.default.isNumber(i)&&(r.resizeWidth=i),_xeUtils.default.isBoolean(o)&&(r.visible=o))})}},saveCustomVisible:function(){var e=this.$toolbar,t=this.collectColumn,o=this.customConfig,i=this.customOpts,r=i.checkMethod,l=i.storage,n=!0===i.storage||l&&l.visible||e&&e.customOpts.storage;if((o||e)&&n){var s=o?this.id:e?e.id:null,a=getCustomStorageMap(visibleStorageKey),c=[],h=[];if(!s)return void _tools.UtilTools.error("vxe.error.reqProp",["id"]);_xeUtils.default.eachTree(t,function(e){if(!r||r({column:e}))if(!e.visible&&e.defaultVisible){var t=e.getKey();t&&c.push(t)}else if(e.visible&&!e.defaultVisible){var o=e.getKey();o&&h.push(o)}}),a[s]=[c.join(",")].concat(h.length?[h.join(",")]:[]).join("|")||void 0,localStorage.setItem(visibleStorageKey,_xeUtils.default.toJSONString(a))}},saveCustomResizable:function(e){var t=this.$toolbar,o=this.collectColumn,i=this.customConfig,r=this.customOpts,l=r.storage,n=!0===r.storage||l&&l.resizable||t&&t.resizableOpts.storage;if((i||t)&&n){var s,a=i?this.id:t?t.id:null,c=getCustomStorageMap(resizableStorageKey);if(!a)return void _tools.UtilTools.error("vxe.error.reqProp",["id"]);e||(s=_xeUtils.default.isPlainObject(c[a])?c[a]:{},_xeUtils.default.eachTree(o,function(e){if(e.resizeWidth){var t=e.getKey();t&&(s[t]=e.renderWidth)}})),c[a]=_xeUtils.default.isEmpty(s)?void 0:s,localStorage.setItem(resizableStorageKey,_xeUtils.default.toJSONString(c))}},refreshColumn:function(){var e=this,n=[],s=[],a=[],t=this.collectColumn,o=this.tableFullColumn,i=this.isGroup,r=this.columnStore,l=this.sXOpts,c=this.scrollXStore;if(i){var h=[],u=[],d=[];_xeUtils.default.eachTree(t,function(e,t,o,i,r){var l=_tools.UtilTools.hasChildrenList(e);r&&r.fixed&&(e.fixed=r.fixed),r&&e.fixed!==r.fixed&&_tools.UtilTools.error("vxe.error.groupFixed"),l?e.visible=!!_xeUtils.default.findTree(e.children,function(e){return _tools.UtilTools.hasChildrenList(e)?null:e.visible}):e.visible&&("left"===e.fixed?n.push(e):"right"===e.fixed?a.push(e):s.push(e))}),t.forEach(function(e){e.visible&&("left"===e.fixed?h.push(e):"right"===e.fixed?d.push(e):u.push(e))}),this.tableGroupColumn=h.concat(u).concat(d)}else o.forEach(function(e){e.visible&&("left"===e.fixed?n.push(e):"right"===e.fixed?a.push(e):s.push(e))});var f=n.concat(s).concat(a),g=f,x=-1<l.gt&&l.gt<o.length;return Object.assign(r,{leftList:n,centerList:s,rightList:a}),x&&i&&(x=!1,_tools.UtilTools.warn("vxe.error.scrollXNotGroup")),x&&(this.showHeader&&!this.showHeaderOverflow&&_tools.UtilTools.warn("vxe.error.reqProp",["show-header-overflow"]),this.showFooter&&!this.showFooterOverflow&&_tools.UtilTools.warn("vxe.error.reqProp",["show-footer-overflow"]),this.spanMethod&&_tools.UtilTools.warn("vxe.error.scrollErrProp",["span-method"]),this.footerSpanMethod&&_tools.UtilTools.warn("vxe.error.scrollErrProp",["footer-span-method"]),Object.assign(c,{startIndex:0,visibleIndex:0}),g=f.slice(c.startIndex,c.startIndex+c.renderSize)),this.scrollXLoad=x,this.tableColumn=g,this.visibleColumn=f,this.$nextTick().then(function(){e.updateFooter(),e.recalculate(!0)})},analyColumnWidth:function(){var t=this.columnWidth,o=this.columnMinWidth,i=[],r=[],l=[],n=[],s=[],a=[];this.tableFullColumn.forEach(function(e){t&&!e.width&&(e.width=t),o&&!e.minWidth&&(e.minWidth=o),e.visible&&(e.resizeWidth?i.push(e):_tools.DomTools.isPx(e.width)?r.push(e):_tools.DomTools.isScale(e.width)?n.push(e):_tools.DomTools.isPx(e.minWidth)?l.push(e):_tools.DomTools.isScale(e.minWidth)?s.push(e):a.push(e))}),Object.assign(this.columnStore,{resizeList:i,pxList:r,pxMinList:l,scaleList:n,scaleMinList:s,autoList:a})},refreshScroll:function(){var e=this,t=this.lastScrollLeft,o=this.lastScrollTop;return this.clearScroll(),this.$nextTick().then(function(){if(t||o)return e.lastScrollLeft=0,e.lastScrollTop=0,e.scrollTo(t,o)})},recalculate:function(e){var t=this,o=this.$refs,i=o.tableBody,r=o.tableHeader,l=o.tableFooter,n=i?i.$el:null,s=r?r.$el:null,a=l?l.$el:null;return n&&(this.autoCellWidth(s,n,a),!0===e)?this.computeScrollLoad().then(function(){t.autoCellWidth(s,n,a),t.computeScrollLoad()}):this.computeScrollLoad()},autoCellWidth:function(e,t,o){var i=0,r=t.clientWidth,l=r,n=l/100,s=this.fit,a=this.columnStore,c=a.resizeList,h=a.pxMinList,u=a.pxList,d=a.scaleList,f=a.scaleMinList,g=a.autoList;if(h.forEach(function(e){var t=parseInt(e.minWidth);i+=t,e.renderWidth=t}),f.forEach(function(e){var t=Math.floor(parseInt(e.minWidth)*n);i+=t,e.renderWidth=t}),d.forEach(function(e){var t=Math.floor(parseInt(e.width)*n);i+=t,e.renderWidth=t}),u.forEach(function(e){var t=parseInt(e.width);i+=t,e.renderWidth=t}),c.forEach(function(e){var t=parseInt(e.resizeWidth);i+=t,e.renderWidth=t}),n=0<(l-=i)?Math.floor(l/(f.length+h.length+g.length)):0,s?0<l&&f.concat(h).forEach(function(e){i+=n,e.renderWidth+=n}):n=40,g.forEach(function(e){var t=Math.max(n,40);e.renderWidth=t,i+=t}),s){var x=d.concat(f).concat(h).concat(g),v=x.length-1;if(0<v){var p=r-i;if(0<p){for(;0<p&&0<=v;)p--,x[v--].renderWidth++;i=r}}}var w=t.offsetHeight,m=t.scrollHeight>t.clientHeight;if(this.scrollbarWidth=m?t.offsetWidth-r:0,this.overflowY=m,this.tableWidth=i,this.tableHeight=w,e?(this.headerHeight=e.clientHeight,e.scrollLeft!==t.scrollLeft&&(e.scrollLeft=t.scrollLeft)):this.headerHeight=0,o){var b=o.offsetHeight;this.scrollbarHeight=Math.max(b-o.clientHeight,0),this.overflowX=i>o.clientWidth,this.footerHeight=b}else this.footerHeight=0,this.scrollbarHeight=Math.max(w-t.clientHeight,0),this.overflowX=r<i;this.parentHeight=Math.max(this.headerHeight+this.footerHeight+20,this.getParentHeight()),this.overflowX&&this.checkScrolling()},updateStyle:function(){var v=this,t=this.$refs,p=this.isGroup,w=this.fullColumnIdData,e=this.height,m=this.parentHeight,b=this.border,R=this.headerHeight,T=this.showFooter,C=this.showOverflow,_=this.showHeaderOverflow,E=this.showFooterOverflow,S=this.footerHeight,k=this.tableHeight,U=this.tableWidth,y=this.scrollbarHeight,D=this.scrollbarWidth,O=this.scrollXLoad,$=this.scrollYLoad,I=this.cellOffsetWidth,M=this.columnStore,A=this.elemStore,o=this.editStore,i=this.currentRow,r=this.mouseConfig,F=this.maxHeight,L=this.tableColumn,z=0;e&&(z="auto"===e?m:(_tools.DomTools.isScale(e)?Math.floor(parseInt(e)/100*m):_xeUtils.default.toNumber(e))-this.getExcludeHeight(),T&&(z+=y));var l=t.emptyPlaceholder,n=A["main-body-wrapper"];return l&&(l.style.top="".concat(R,"px"),l.style.height=n?"".concat(n.offsetHeight-y,"px"):""),["main","left","right"].forEach(function(d,e){var f=0<e?d:"",g=M["".concat(f,"List")],x=t["".concat(f,"Container")];["header","body","footer"].forEach(function(c){var e=A["".concat(d,"-").concat(c,"-wrapper")],t=A["".concat(d,"-").concat(c,"-table")];if("header"===c){var o=U;O&&(f&&(L=g),o=L.reduce(function(e,t){return e+t.renderWidth},0)),t&&(t.style.width=o?"".concat(o+D,"px"):"",browse.msie&&_xeUtils.default.arrayEach(t.querySelectorAll(".vxe-resizable"),function(e){e.style.height="".concat(e.parentNode.offsetHeight,"px")}));var i=A["".concat(d,"-").concat(c,"-repair")];i&&(i.style.width="".concat(U,"px"));var r=A["".concat(d,"-").concat(c,"-list")];p&&r&&_xeUtils.default.arrayEach(r.querySelectorAll(".col--group"),function(e){var t=v.getColumnNode(e).item,o=t.showHeaderOverflow,i=_xeUtils.default.isBoolean(o)?o:_,r="title"===i||(!0===i||"tooltip"===i)||"ellipsis"===i,l=0,n=0;r&&_xeUtils.default.eachTree(t.children,function(e){e.children&&t.children.length||n++,l+=e.renderWidth}),e.style.width=r?"".concat(l-n-(b?2:0),"px"):""})}else if("body"===c){var l=A["".concat(d,"-").concat(c,"-emptyBlock")];if(e&&(F?(F="auto"===F?m:_tools.DomTools.isScale(F)?Math.floor(parseInt(F)/100*m):_xeUtils.default.toNumber(F),e.style.maxHeight="".concat(f?F-R-(T?0:y):F-R,"px")):e.style.height=0<z?"".concat(f?(0<z?z-R-S:k)-(T?0:y):z-R-S,"px"):""),x){var n="right"===f,s=M["".concat(f,"List")];e.style.top="".concat(R,"px"),x.style.height="".concat((0<z?z-R-S:k)+R+S-y*(T?2:1),"px"),x.style.width="".concat(s.reduce(function(e,t){return e+t.renderWidth},n?D:0),"px")}var a=U;f&&C?a=(L=g).reduce(function(e,t){return e+t.renderWidth},0):O&&(f&&(L=g),a=L.reduce(function(e,t){return e+t.renderWidth},0)),t&&(t.style.width=a?"".concat(a,"px"):"",t.style.paddingRight=D&&f&&(browse["-moz"]||browse.safari)?"".concat(D,"px"):""),l&&(l.style.width=a?"".concat(a,"px"):"")}else if("footer"===c){var h=U;f&&C?h=(L=g).reduce(function(e,t){return e+t.renderWidth},0):O&&(f&&(L=g),h=L.reduce(function(e,t){return e+t.renderWidth},0)),e&&(x&&(e.style.top="".concat(0<z?z-S:k+R,"px")),e.style.marginTop="".concat(-y,"px")),t&&(t.style.width=h?"".concat(h+D,"px"):"")}var u=A["".concat(d,"-").concat(c,"-colgroup")];u&&_xeUtils.default.arrayEach(u.children,function(e){var t=e.getAttribute("name");if("col_gutter"===t&&(e.style.width="".concat(D,"px")),w[t]){var o,s=w[t].column,i=s.showHeaderOverflow,r=s.showFooterOverflow,l=s.showOverflow;e.style.width="".concat(s.renderWidth,"px");var a="title"===(o="header"===c?_xeUtils.default.isUndefined(i)||_xeUtils.default.isNull(i)?_:i:"footer"===c?_xeUtils.default.isUndefined(r)||_xeUtils.default.isNull(r)?E:r:_xeUtils.default.isUndefined(l)||_xeUtils.default.isNull(l)?C:l)||(!0===o||"tooltip"===o)||"ellipsis"===o,n=A["".concat(d,"-").concat(c,"-list")];"header"===c||"footer"===c?O&&!a&&(a=!0):!O&&!$||a||(a=!0),n&&_xeUtils.default.arrayEach(n.querySelectorAll(".".concat(s.id)),function(e){var t=parseInt(e.getAttribute("colspan")||1),o=e.querySelector(".vxe-cell"),i=s.renderWidth;if(o){if(1<t)for(var r=v.getColumnIndex(s),l=1;l<t;l++){var n=v.getColumns(r+l);n&&(i+=n.renderWidth)}o.style.width=a?"".concat(i-I*t,"px"):""}})}})})}),i&&this.setCurrentRow(i),r&&r.selected&&o.selected.row&&o.selected.column&&this.addColSdCls(),this.$nextTick()},checkScrolling:function(){var e=this.$refs,t=e.tableBody,o=e.leftContainer,i=e.rightContainer,r=t?t.$el:null;r&&(o&&_tools.DomTools[0<r.scrollLeft?"addClass":"removeClass"](o,"scrolling--middle"),i&&_tools.DomTools[r.clientWidth<r.scrollWidth-Math.ceil(r.scrollLeft)?"addClass":"removeClass"](i,"scrolling--middle"))},preventEvent:function(t,e,o,i,r){var l,n=this;return _vXETable.default.interceptor.get(e).some(function(e){return!1===e(Object.assign({$grid:n.$xegrid,$table:n,$event:t},o),t,n)})||i&&(l=i()),r&&r(),l},handleGlobalMousedownEvent:function(o){var i=this,r=this.$el,e=this.$refs,t=this.mouseConfig,l=this.mouseOpts,n=this.editStore,s=this.ctxMenuStore,a=this.editOpts,c=this.filterStore,h=this.getRowNode,u=n.actived,d=e.filterWrapper,f=e.validTip,g=t&&(l.range||l.checked);d&&(_tools.DomTools.getEventTargetNode(o,r,"vxe-cell--filter").flag||_tools.DomTools.getEventTargetNode(o,d.$el).flag||_tools.DomTools.getEventTargetNode(o,document.body,"vxe-table--ignore-clear").flag||this.preventEvent(o,"event.clearFilter",c.args,this.closeFilter)),u.row?!1!==a.autoClear&&(f&&_tools.DomTools.getEventTargetNode(o,f.$el).flag||(!this.lastCallTime||this.lastCallTime+50<Date.now())&&(_tools.DomTools.getEventTargetNode(o,document.body,"vxe-table--ignore-clear").flag||this.preventEvent(o,"event.clearActived",u.args,function(){var e;if("row"===a.mode){var t=_tools.DomTools.getEventTargetNode(o,r,"vxe-body--row");e=!!t.flag&&h(t.targetElem).item!==u.args.row}else e=!_tools.DomTools.getEventTargetNode(o,r,"col--edit").flag;e||(e=_tools.DomTools.getEventTargetNode(o,r,"vxe-header--row").flag),e||(e=_tools.DomTools.getEventTargetNode(o,r,"vxe-footer--row").flag),!e&&_tools.DomTools.getEventTargetNode(o,r).flag||setTimeout(function(){return i.clearActived(o)})}))):t&&(_tools.DomTools.getEventTargetNode(o,r).flag||_tools.DomTools.getEventTargetNode(o,e.tableWrapper).flag||(g&&(this.clearIndexChecked(),this.clearHeaderChecked(),this.clearChecked()),this.clearSelected())),s.visible&&this.$refs.ctxWrapper&&!_tools.DomTools.getEventTargetNode(o,this.$refs.ctxWrapper.$el).flag&&this.closeMenu(),this.isActivated=_tools.DomTools.getEventTargetNode(o,(this.$xegrid||this).$el).flag},handleGlobalBlurEvent:function(){this.closeFilter(),this.closeMenu()},handleGlobalMousewheelEvent:function(){this.clostTooltip(),this.closeMenu()},handleGlobalKeydownEvent:function(z){var H=this;this.isActivated&&this.preventEvent(z,"event.keydown",null,function(){var e,t=H.isCtxMenu,o=H.ctxMenuStore,i=H.editStore,r=H.editOpts,l=H.mouseConfig,n=void 0===l?{}:l,s=H.keyboardConfig,a=void 0===s?{}:s,c=H.treeConfig,h=H.treeOpts,u=H.highlightCurrentRow,d=H.currentRow,f=i.selected,g=i.actived,x=z.keyCode,v=8===x,p=9===x,w=13===x,m=27===x,b=32===x,R=37===x,T=38===x,C=39===x,_=40===x,E=46===x,S=65===x,k=67===x,U=86===x,y=88===x,D=113===x,O=z.ctrlKey,$=z.shiftKey,I=R||T||C||_,M=t&&o.visible&&(w||b||I);if(m)H.closeMenu(),H.closeFilter(),g.row&&(e=g.args,H.clearActived(z),n.selected&&H.$nextTick(function(){return H.handleSelected(e,z)}));else if(b&&(a.isArrow||a.isTab)&&f.row&&f.column&&("checkbox"===f.column.type||"selection"===f.column.type||"radio"===f.column.type))z.preventDefault(),"checkbox"===f.column.type||"selection"===f.column.type?H.handleToggleCheckRowEvent(f.args,z):H.triggerRadioRowEvent(z,f.args);else if(w&&a.isEnter&&(f.row||g.row||c&&u&&d)){if(O)g.row&&(e=g.args,H.clearActived(z),n.selected&&H.$nextTick(function(){return H.handleSelected(e,z)}));else if(f.row||g.row)$?H.moveSelected(f.row?f.args:g.args,R,!0,C,!1,z):H.moveSelected(f.row?f.args:g.args,R,!1,C,!0,z);else if(c&&u&&d){var A=d[h.children];if(A&&A.length){z.preventDefault();var F=A[0];e={$table:H,row:F},H.setTreeExpand(d,!0).then(function(){return H.scrollToRow(F)}).then(function(){return H.triggerCurrentRowEvent(z,e)})}}}else if(M)z.preventDefault(),o.showChild&&_tools.UtilTools.hasChildrenList(o.selected)?H.moveCtxMenu(z,x,o,"selectChild",37,!1,o.selected.children):H.moveCtxMenu(z,x,o,"selected",39,!0,H.ctxMenuList);else if(D)f.row&&f.column&&(z.preventDefault(),H.handleActived(f.args,z));else if(I&&a.isArrow)f.row&&f.column?H.moveSelected(f.args,R,T,C,_,z):(T||_)&&u&&d&&H.moveCurrentRow(T,_,z);else if(p&&a.isTab)f.row||f.column?H.moveTabSelected(f.args,$,z):(g.row||g.column)&&H.moveTabSelected(g.args,$,z);else if(E||(c&&u&&d?v&&a.isArrow:v)){if(a.isDel&&(f.row||f.column))_tools.UtilTools.setCellValue(f.row,f.column,null),v&&H.handleActived(f.args,z);else if(v&&a.isArrow&&c&&u&&d){var L=_xeUtils.default.findTree(H.afterFullData,function(e){return e===d},h).parent;L&&(z.preventDefault(),e={$table:H,row:L},H.setTreeExpand(L,!1).then(function(){return H.scrollToRow(L)}).then(function(){return H.triggerCurrentRowEvent(z,e)}))}}else a.isCut&&O&&(S||y||k||U)?S?H.handleAllChecked(z):y||k?H.handleCopyed(y,z):H.handlePaste(z):a.isEdit&&!O&&(b||48<=x&&x<=57||65<=x&&x<=90||96<=x&&x<=111||186<=x&&x<=192||219<=x&&x<=222)&&f.column&&f.row&&f.column.editRender&&(a.editMethod&&!1===a.editMethod(f.args,z)||r.activeMethod&&!r.activeMethod(f.args)||(_tools.UtilTools.setCellValue(f.row,f.column,null),H.handleActived(f.args,z)));H.emitEvent("keydown",{},z)})},handleGlobalResizeEvent:function(){this.closeMenu(),this.recalculate(!0)},handleTooltipLeaveEvent:function(){var e=this,t=this.tooltipOpts;setTimeout(function(){e.tooltipActive||e.clostTooltip()},t.leaveDelay)},handleTargetEnterEvent:function(){clearTimeout(this.tooltipTimeout),this.tooltipActive=!0,this.clostTooltip()},handleTargetLeaveEvent:function(){var e=this,t=this.tooltipOpts;this.tooltipActive=!1,t.enterable?this.tooltipTimeout=setTimeout(function(){e.$refs.tooltip.isHover||e.clostTooltip()},t.leaveDelay):this.clostTooltip()},triggerHeaderTooltipEvent:function(e,t){var o=this.tooltipStore,i=t.column,r=e.currentTarget;this.handleTargetEnterEvent(),o.column===i&&o.visible||this.handleTooltip(e,r,r.querySelector(".vxe-cell--title"),t)},triggerFooterTooltipEvent:function(e,t){var o=this.tooltipStore,i=t.column,r=e.currentTarget;this.handleTargetEnterEvent(),o.column===i&&o.visible||this.handleTooltip(e,r,r.children[0],t)},triggerTooltipEvent:function(e,t){var o=this.editConfig,i=this.editOpts,r=this.editStore,l=this.tooltipStore,n=r.actived,s=t.row,a=t.column,c=e.currentTarget;this.handleTargetEnterEvent(),o&&("row"===i.mode&&n.row===s||n.row===s&&n.column===a)||l.column===a&&l.row===s&&l.visible||this.handleTooltip(e,c,a.treeNode?c.querySelector(".vxe-tree-cell"):c.children[0],t)},handleTooltip:function(e,t,o,i){i.cell=t;var r=this.$refs,l=this.tooltipOpts,n=this.tooltipStore,s=i.column,a=i.row,c=l.enabled,h=l.contentMethod,u=r.tooltip,d=h?h(i):null,f=h&&!_xeUtils.default.eqNull(d),g=f?d:("html"===s.type?o.innerText:o.textContent).trim();return g&&(c||f||o.scrollWidth>o.clientWidth)&&(Object.assign(n,{row:a,column:s,visible:!0}),u&&u.toVisible(o,_tools.UtilTools.formatText(g))),this.$nextTick()},clostTooltip:function(){var e=this.$refs.tooltip;return Object.assign(this.tooltipStore,{row:null,column:null,content:null,visible:!1}),e&&e.close(),this.$nextTick()},isAllCheckboxChecked:function(){return this.isAllSelected},isCheckboxIndeterminate:function(){return this.isIndeterminate},getCheckboxIndeterminateRecords:function(){var e=this.treeConfig,t=this.treeIndeterminates;return e?t.slice(0):[]},handleDefaultSelectionChecked:function(){var t=this.fullDataRowIdData,o=this.checkboxOpts,i=this.checkboxReserveRowMap,e=o.checkAll,r=o.checkRowKeys;if(e)this.setAllCheckboxRow(!0);else if(r){var l=[],n=_tools.UtilTools.getRowkey(this);r.forEach(function(e){t[e]&&l.push(t[e].row),o.reserve&&(i[e]=_defineProperty({},n,e))}),this.setCheckboxRow(l,!0)}},setSelection:function(e,t){return _tools.UtilTools.warn("vxe.error.delFunc",["setSelection","setCheckboxRow"]),this.setCheckboxRow(e,t)},setCheckboxRow:function(e,t){var o=this;return e&&!_xeUtils.default.isArray(e)&&(e=[e]),e.forEach(function(e){return o.handleSelectRow({row:e},!!t)}),this.$nextTick()},isCheckedByRow:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["isCheckedByRow","isCheckedByCheckboxRow"]),this.isCheckedByCheckboxRow(e)},isCheckedByCheckboxRow:function(e){var t=this.checkboxOpts.checkField;return t?_xeUtils.default.get(e,t):-1<this.selection.indexOf(e)},handleSelectRow:function(e,o){var i=this,r=e.row,l=this.selection,t=this.afterFullData,n=this.treeConfig,s=this.treeOpts,a=this.treeIndeterminates,c=this.checkboxOpts,h=c.checkField,u=c.checkStrictly,d=c.checkMethod;if(h)if(n&&!u){-1===o?(-1===a.indexOf(r)&&a.push(r),_xeUtils.default.set(r,h,!1)):_xeUtils.default.eachTree([r],function(t){r!==t&&d&&!d({row:t})||(_xeUtils.default.set(t,h,o),_xeUtils.default.remove(a,function(e){return e===t}),i.handleCheckboxReserveRow(r,o))},s);var f=_xeUtils.default.findTree(t,function(e){return e===r},s);if(f&&f.parent){var g,x=d?f.items.filter(function(e){return d({row:e})}):f.items;if(_xeUtils.default.find(f.items,function(e){return-1<a.indexOf(e)}))g=-1;else{var v=f.items.filter(function(e){return _xeUtils.default.get(e,h)});g=v.filter(function(e){return-1<x.indexOf(e)}).length===x.length||!(!v.length&&-1!==o)&&-1}return this.handleSelectRow({row:f.parent},g)}}else d&&!d({row:r})||(_xeUtils.default.set(r,h,o),this.handleCheckboxReserveRow(r,o));else if(n&&!u){-1===o?(-1===a.indexOf(r)&&a.push(r),_xeUtils.default.remove(l,function(e){return e===r})):_xeUtils.default.eachTree([r],function(t){r!==t&&d&&!d({row:t})||(o?l.push(t):_xeUtils.default.remove(l,function(e){return e===t}),_xeUtils.default.remove(a,function(e){return e===t}),i.handleCheckboxReserveRow(r,o))},s);var p=_xeUtils.default.findTree(t,function(e){return e===r},s);if(p&&p.parent){var w,m=d?p.items.filter(function(e){return d({row:e})}):p.items;if(_xeUtils.default.find(p.items,function(e){return-1<a.indexOf(e)}))w=-1;else{var b=p.items.filter(function(e){return-1<l.indexOf(e)});w=b.filter(function(e){return-1<m.indexOf(e)}).length===m.length||!(!b.length&&-1!==o)&&-1}return this.handleSelectRow({row:p.parent},w)}}else d&&!d({row:r})||(o?-1===l.indexOf(r)&&l.push(r):_xeUtils.default.remove(l,function(e){return e===r}),this.handleCheckboxReserveRow(r,o));this.checkSelectionStatus()},handleToggleCheckRowEvent:function(e,t){var o=this.selection,i=this.checkboxOpts.checkField,r=e.row,l=i?!_xeUtils.default.get(r,i):-1===o.indexOf(r);t?this.triggerCheckRowEvent(t,e,l):this.handleSelectRow(e,l)},triggerCheckRowEvent:function(e,t,o){var i=this.checkboxOpts.checkMethod;if(!i||i({row:t.row})){this.handleSelectRow(t,o);var r=this.getCheckboxRecords();this.$listeners["select-change"]?(_tools.UtilTools.warn("vxe.error.delEvent",["select-change","checkbox-change"]),this.emitEvent("select-change",Object.assign({records:r,selection:r,reserves:this.getCheckboxReserveRecords(),checked:o},t),e)):this.emitEvent("checkbox-change",Object.assign({records:r,selection:r,reserves:this.getCheckboxReserveRecords(),indeterminates:this.getCheckboxIndeterminateRecords(),checked:o},t),e)}},toggleRowSelection:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["toggleRowSelection","toggleCheckboxRow"]),this.toggleCheckboxRow(e)},toggleCheckboxRow:function(e){return this.handleToggleCheckRowEvent({row:e}),this.$nextTick()},setAllSelection:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["setAllSelection","setAllCheckboxRow"]),this.setAllCheckboxRow(e)},setAllCheckboxRow:function(t){var o=this,i=this.afterFullData,e=this.treeConfig,r=this.treeOpts,l=this.selection,n=this.checkboxReserveRowMap,s=this.checkboxOpts,a=s.checkField,c=s.reserve,h=s.checkStrictly,u=s.checkMethod,d=[],f=e?[]:l.filter(function(e){return-1===i.indexOf(e)});if(h)this.isAllSelected=t;else{if(a){var g=function(e){u&&!u({row:e})||_xeUtils.default.set(e,a,t)},x=function(e){(!u||!u({row:e})&&-1<l.indexOf(e))&&_xeUtils.default.set(e,a,t)};e?_xeUtils.default.eachTree(i,t?g:x,r):i.forEach(t?g:x)}else e?t?_xeUtils.default.eachTree(i,function(e){u&&!u({row:e})||d.push(e)},r):u&&_xeUtils.default.eachTree(i,function(e){!u({row:e})&&-1<l.indexOf(e)&&d.push(e)},r):t?d=u?i.filter(function(e){return-1<l.indexOf(e)||u({row:e})}):i.slice(0):u&&(d=i.filter(function(e){return u({row:e})?0:-1<l.indexOf(e)}));c&&(t?d.forEach(function(e){n[_tools.UtilTools.getRowid(o,e)]=e}):i.forEach(function(e){var t=_tools.UtilTools.getRowid(o,e);n[t]&&delete n[t]})),this.selection=f.concat(d)}this.treeIndeterminates=[],this.checkSelectionStatus()},checkSelectionStatus:function(){var e=this.afterFullData,t=this.selection,o=this.treeIndeterminates,i=this.checkboxOpts,r=this.treeConfig,l=i.checkField,n=i.halfField,s=i.checkStrictly,a=i.checkMethod;if(!s){var c=!1,h=!1;h=l?(c=e.length&&e.every(a?function(e){return!a({row:e})||_xeUtils.default.get(e,l)}:function(e){return _xeUtils.default.get(e,l)}),r?n?!c&&e.some(function(e){return _xeUtils.default.get(e,l)||_xeUtils.default.get(e,n)||-1<o.indexOf(e)}):!c&&e.some(function(e){return _xeUtils.default.get(e,l)||-1<o.indexOf(e)}):n?!c&&e.some(function(e){return _xeUtils.default.get(e,l)||_xeUtils.default.get(e,n)}):!c&&e.some(function(e){return _xeUtils.default.get(e,l)})):(c=e.length&&e.every(a?function(e){return!a({row:e})||-1<t.indexOf(e)}:function(e){return-1<t.indexOf(e)}),r?!c&&e.some(function(e){return-1<o.indexOf(e)||-1<t.indexOf(e)}):!c&&e.some(function(e){return-1<t.indexOf(e)})),this.isAllSelected=c,this.isIndeterminate=h}},handleReserveStatus:function(){var e=this.expandColumn,t=this.treeConfig,o=this.fullDataRowIdData,i=this.fullAllDataRowMap,r=this.currentRow,l=this.selectRow,n=this.radioReserveRow,s=this.radioOpts,a=this.checkboxReserveRowMap,c=this.checkboxOpts,h=this.selection,u=this.rowExpandeds,d=this.treeExpandeds,f=this.treeIndeterminates;if(l&&!i.has(l)&&(this.selectRow=null),s.reserve&&n){var g=_tools.UtilTools.getRowid(this,n);o[g]&&this.setRadioRow(o[g].row)}if(this.selection=handleReserveRow(this,h),c.reserve){var x=[];_xeUtils.default.each(a,function(e,t){o[t]&&-1===x.indexOf(o[t].row)&&x.push(o[t].row)}),this.setCheckboxRow(x,!0)}r&&!i.has(r)&&(this.currentRow=null),this.rowExpandeds=e?handleReserveRow(this,u):[],this.treeExpandeds=t?handleReserveRow(this,d):[],this.treeIndeterminates=t?handleReserveRow(this,f):[]},getRadioReserveRecord:function(){var e=this.fullDataRowIdData,t=this.radioReserveRow;return this.radioOpts.reserve&&t&&!e[_tools.UtilTools.getRowid(this,t)]?t:null},clearRadioReserve:function(){return this.radioReserveRow=null,this.$nextTick()},handleRadioReserveRow:function(e){this.radioOpts.reserve&&(this.radioReserveRow=e)},getSelectReserveRecords:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getSelectReserveRecords","getCheckboxReserveRecords"]),this.getCheckboxReserveRecords()},getCheckboxReserveRecords:function(){var t=this.fullDataRowIdData,o=this.checkboxReserveRowMap,e=this.checkboxOpts,i=[];return e.reserve&&Object.keys(o).forEach(function(e){t[e]||i.push(o[e])}),i},clearSelectReserve:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["clearSelectReserve","clearCheckboxReserve"]),this.clearCheckboxReserve()},clearCheckboxReserve:function(){return this.checkboxReserveRowMap={},this.$nextTick()},handleCheckboxReserveRow:function(e,t){var o=this.checkboxReserveRowMap;if(this.checkboxOpts.reserve){var i=_tools.UtilTools.getRowid(this,e);t?o[i]=e:o[i]&&delete o[i]}},triggerCheckAllEvent:function(e,t){this.setAllCheckboxRow(t);var o=this.getCheckboxRecords();this.$listeners["select-all"]?(_tools.UtilTools.warn("vxe.error.delEvent",["select-all","checkbox-all"]),this.emitEvent("select-all",{records:o,selection:o,reserves:this.getCheckboxReserveRecords(),checked:t},e)):this.emitEvent("checkbox-all",{records:o,selection:o,reserves:this.getCheckboxReserveRecords(),indeterminates:this.getCheckboxIndeterminateRecords(),checked:t},e)},toggleAllSelection:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["toggleAllSelection","toggleAllCheckboxRow"]),this.toggleAllCheckboxRow()},toggleAllCheckboxRow:function(){return this.triggerCheckAllEvent(null,!this.isAllSelected),this.$nextTick()},clearSelection:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["clearSelection","clearCheckboxRow"]),this.clearCheckboxRow()},clearCheckboxRow:function(){var o=this,e=this.tableFullData,t=this.treeConfig,i=this.treeOpts,r=this.checkboxOpts,l=this.checkboxReserveRowMap,n=r.checkField,s=r.reserve;return n&&(t?_xeUtils.default.eachTree(e,function(e){return _xeUtils.default.set(e,n,!1)},i):e.forEach(function(e){return _xeUtils.default.set(e,n,!1)})),s&&e.forEach(function(e){var t=_tools.UtilTools.getRowid(o,e);l[t]&&delete l[t]}),this.isAllSelected=!1,this.isIndeterminate=!1,this.selection=[],this.treeIndeterminates=[],this.$nextTick()},handleDefaultRadioChecked:function(){var e=this.radioOpts,t=this.fullDataRowIdData,o=e.checkRowKey,i=e.reserve;if(o&&(t[o]&&this.setRadioRow(t[o].row),i)){var r=_tools.UtilTools.getRowkey(this);this.radioReserveRow=_defineProperty({},r,o)}},triggerRadioRowEvent:function(e,t){var o=this.selectRow!==t.row;this.setRadioRow(t.row),o&&this.emitEvent("radio-change",t,e)},triggerCurrentRowEvent:function(e,t){var o=this.currentRow!==t.row;this.setCurrentRow(t.row),o&&this.emitEvent("current-change",t,e)},setCurrentRow:function(e){return this.clearCurrentRow(),this.clearCurrentColumn(),this.currentRow=e,this.highlightCurrentRow&&_xeUtils.default.arrayEach(this.$el.querySelectorAll('[data-rowid="'.concat(_tools.UtilTools.getRowid(this,e),'"]')),function(e){return _tools.DomTools.addClass(e,"row--current")}),this.$nextTick()},isCheckedByRadioRow:function(e){return this.selectRow===e},setRadioRow:function(e){var t=this.radioOpts.checkMethod;return!e||t&&!t({row:e})||(this.selectRow=e,this.handleRadioReserveRow(e)),this.$nextTick()},clearCurrentRow:function(){return this.currentRow=null,this.hoverRow=null,_xeUtils.default.arrayEach(this.$el.querySelectorAll(".row--current"),function(e){return _tools.DomTools.removeClass(e,"row--current")}),this.$nextTick()},clearRadioRow:function(){return this.selectRow=null,this.$nextTick()},getCurrentRow:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getCurrentRow","getCurrentRecord"]),this.getCurrentRecord()},getCurrentRecord:function(){return this.highlightCurrentRow?this.currentRow:null},getRadioRow:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getRadioRow","getRadioRecord"]),this.getRadioRecord()},getRadioRecord:function(){return this.selectRow},triggerHoverEvent:function(e,t){var o=t.row;this.setHoverRow(o)},setHoverRow:function(e){var t=_tools.UtilTools.getRowid(this,e);this.clearHoverRow(),_xeUtils.default.arrayEach(this.$el.querySelectorAll('[data-rowid="'.concat(t,'"]')),function(e){return _tools.DomTools.addClass(e,"row--hover")}),this.hoverRow=e},clearHoverRow:function(){_xeUtils.default.arrayEach(this.$el.querySelectorAll(".vxe-body--row.row--hover"),function(e){return _tools.DomTools.removeClass(e,"row--hover")}),this.hoverRow=null},triggerHeaderCellClickEvent:function(e,t){var o=this._lastResizeTime,i=this.sortOpts,r=t.column,l=e.currentTarget,n=o&&o>Date.now()-300,s=_tools.DomTools.getEventTargetNode(e,l,"vxe-cell--sort").flag,a=_tools.DomTools.getEventTargetNode(e,l,"vxe-cell--filter").flag;return"cell"!==i.trigger||n||s||a||this.triggerSortEvent(e,r,getNextSortOrder(this,r)),this.emitEvent("header-cell-click",Object.assign({triggerResizable:n,triggerSort:s,triggerFilter:a,cell:l},t),e),this.highlightCurrentColumn?this.setCurrentColumn(r):this.$nextTick()},triggerHeaderCellDBLClickEvent:function(e,t){this.emitEvent("header-cell-dblclick",Object.assign({cell:e.currentTarget},t),e)},getCurrentColumn:function(){return this.highlightCurrentColumn?this.currentColumn:null},setCurrentColumn:function(e){return this.clearCurrentRow(),this.clearCurrentColumn(),this.currentColumn=e,this.$nextTick()},clearCurrentColumn:function(){return this.currentColumn=null,this.$nextTick()},checkValidate:function(e){return _vXETable.default._valid?this.triggerValidate(e):this.$nextTick()},handleChangeCell:function(e,t){var o=this;this.checkValidate("blur").catch(function(e){return e}).then(function(){o.handleActived(t,e).then(function(){return o.checkValidate("change")}).catch(function(e){return e})})},triggerCellClickEvent:function(e,t){var o=this.highlightCurrentRow,i=this.editStore,r=this.radioOpts,l=this.expandOpts,n=this.treeOpts,s=this.editConfig,a=this.editOpts,c=this.checkboxOpts,h=this.mouseConfig,u=this.mouseOpts,d=i.actived,f=t,g=f.row,x=f.column,v=x.type,p=x.treeNode,w="radio"===v,m="checkbox"===v||"selection"===v,b="expand"===v,R=e.currentTarget,T=w&&_tools.DomTools.getEventTargetNode(e,R,"vxe-cell--radio").flag,C=m&&_tools.DomTools.getEventTargetNode(e,R,"vxe-cell--checkbox").flag,_=p&&_tools.DomTools.getEventTargetNode(e,R,"vxe-tree--btn-wrapper").flag,E=b&&_tools.DomTools.getEventTargetNode(e,R,"vxe-table--expanded").flag;t=Object.assign({cell:R,triggerRadio:T,triggerCheckbox:C,triggerTreeNode:_,triggerExpandNode:E},t);var S=h&&(u.range||u.checked);!E&&("row"===l.trigger||b&&"cell"===l.trigger)&&this.triggerRowExpandEvent(e,t),("row"===n.trigger||p&&"cell"===n.trigger)&&this.triggerTreeExpandEvent(e,t),_||(E||(o&&(C||T||this.triggerCurrentRowEvent(e,t)),!T&&("row"===r.trigger||w&&"cell"===r.trigger)&&this.triggerRadioRowEvent(e,t),!C&&("row"===c.trigger||m&&"cell"===c.trigger)&&this.handleToggleCheckRowEvent(t,e)),S||s&&("manual"===a.trigger?d.args&&d.row===g&&x!==d.column&&this.handleChangeCell(e,t):d.args&&g===d.row&&x===d.column||("click"===a.trigger?this.handleChangeCell(e,t):"dblclick"===a.trigger&&"row"===a.mode&&d.row===g&&this.handleChangeCell(e,t)))),this.emitEvent("cell-click",t,e)},triggerCellDBLClickEvent:function(e,t){var o=this,i=this.editStore,r=this.editConfig,l=this.editOpts,n=i.actived,s=e.currentTarget;t.cell=s,r&&"dblclick"===l.trigger&&(n.args&&e.currentTarget===n.args.cell||("row"===l.mode?this.checkValidate("blur").catch(function(e){return e}).then(function(){o.handleActived(t,e).then(function(){return o.checkValidate("change")}).catch(function(e){return e})}):"cell"===l.mode&&this.handleActived(t,e).then(function(){return o.checkValidate("change")}).catch(function(e){return e}))),this.emitEvent("cell-dblclick",t,e)},handleDefaultSort:function(){var e=this.sortOpts.defaultSort;if(e){var t=e.field,o=e.order;if(t&&o){var i=_xeUtils.default.find(this.visibleColumn,function(e){return e.property===t});i&&!i.order&&this.sort(t,o)}}},triggerSortEvent:function(e,t,o){var i=t.property;if(t.sortable||t.remoteSort){var r={column:t,property:i,field:i,prop:i,order:o,sortBy:t.sortBy,$table:this,$event:e};o&&t.order!==o?this.sort(i,o):(r.order=null,this.clearSort()),this.emitEvent("sort-change",r,e)}},sort:function(e,t){var o=this.tableFullColumn,i=this.sortOpts,r=this.getColumnByField(e);if(r){var l=_xeUtils.default.isBoolean(r.remoteSort)?r.remoteSort:i.remote;if(r.sortable||r.remoteSort)return arguments.length<=1&&(t=getNextSortOrder(this,r)),r.order!==t&&(o.forEach(function(e){e.order=null}),r.order=t,l||this.handleTableData(!0)),this.$nextTick().then(this.updateStyle)}return this.$nextTick()},clearSort:function(){return this.tableFullColumn.forEach(function(e){e.order=null}),this.handleTableData(!0)},getSortColumn:function(){return _xeUtils.default.find(this.visibleColumn,function(e){return e.sortable&&e.order})},closeFilter:function(){return Object.assign(this.filterStore,{isAllSelected:!1,isIndeterminate:!1,options:[],visible:!1}),this.$nextTick()},isFilter:function(e){if(e){var t=this.getColumnByField(e);return t.filters&&t.filters.some(function(e){return e.checked})}return this.visibleColumn.some(function(e){return e.filters&&e.filters.some(function(e){return e.checked})})},isRowExpandLoaded:function(e){var t=this.fullAllDataRowMap.get(e);return t&&t.expandLoaded},clearRowExpandLoaded:function(t){var e=this.expandOpts,o=this.expandLazyLoadeds,i=this.fullAllDataRowMap,r=e.lazy,l=i.get(t);return r&&l&&(l.expandLoaded=!1,_xeUtils.default.remove(o,function(e){return t===e})),this.$nextTick()},reloadExpandContent:function(e){var t=this,o=this.expandOpts,i=this.expandLazyLoadeds;return o.lazy&&-1===i.indexOf(e)&&this.clearRowExpandLoaded(e).then(function(){return t.handleAsyncRowExpand(e)}),this.$nextTick()},triggerRowExpandEvent:function(e,t){var o=this.$listeners,i=this.expandOpts,r=this.expandLazyLoadeds,l=this.expandColumn,n=t.row;if(!i.lazy||-1===r.indexOf(n)){var s=!this.isExpandByRow(n),a=this.getColumnIndex(l),c=this.$getColumnIndex(l);this.setRowExpand(n,s),o["toggle-expand-change"]?(_tools.UtilTools.warn("vxe.error.delEvent",["toggle-expand-change","toggle-row-expand"]),this.emitEvent("toggle-expand-change",{expanded:s,column:l,columnIndex:a,$columnIndex:c,row:n,rowIndex:this.getRowIndex(n),$rowIndex:this.$getRowIndex(n)},e)):this.emitEvent("toggle-row-expand",{expanded:s,column:l,columnIndex:a,$columnIndex:c,row:n,rowIndex:this.getRowIndex(n),$rowIndex:this.$getRowIndex(n)},e)}},toggleRowExpansion:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["toggleRowExpansion","toggleRowExpand"]),this.toggleRowExpand(e)},toggleRowExpand:function(e){return this.setRowExpand(e,!this.isExpandByRow(e))},handleDefaultRowExpand:function(){var e=this.expandOpts,t=this.fullDataRowIdData,o=e.expandAll,i=e.expandRowKeys;if(o)this.setAllRowExpand(!0);else if(i){var r=[];i.forEach(function(e){t[e]&&r.push(t[e].row)}),this.setRowExpand(r,!0)}},setAllRowExpansion:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["setAllRowExpansion","setAllRowExpand"]),this.setAllRowExpand(e)},setAllRowExpand:function(e){return this.setRowExpand(this.expandOpts.lazy?this.tableData:this.tableFullData,e)},handleAsyncRowExpand:function(t){var o=this,i=this.fullAllDataRowMap.get(t);return new Promise(function(e){o.expandLazyLoadeds.push(t),o.expandOpts.loadMethod({$table:o,row:t,rowIndex:o.getRowIndex(t),$rowIndex:o.$getRowIndex(t)}).catch(function(e){return e}).then(function(){i.expandLoaded=!0,_xeUtils.default.remove(o.expandLazyLoadeds,function(e){return e===t}),o.rowExpandeds.push(t),e(o.$nextTick().then(o.recalculate))})})},setRowExpansion:function(e,t){return _tools.UtilTools.warn("vxe.error.delFunc",["setRowExpansion","setRowExpand"]),this.setRowExpand(e,t)},setRowExpand:function(e,t){var o=this,i=this.fullAllDataRowMap,r=this.expandLazyLoadeds,l=this.expandOpts,n=this.expandColumn,s=this.rowExpandeds,a=l.lazy,c=l.accordion,h=l.toggleMethod,u=[],d=this.getColumnIndex(n),f=this.$getColumnIndex(n);if(e){_xeUtils.default.isArray(e)||(e=[e]),c&&(s=[],e=e.slice(e.length-1,e.length));var g=h?e.filter(function(e){return h({expanded:t,column:n,columnIndex:d,$columnIndex:f,row:e,rowIndex:o.getRowIndex(e),$rowIndex:o.$getRowIndex(e)})}):e;t?g.forEach(function(e){if(-1===s.indexOf(e)){var t=i.get(e);a&&!t.expandLoaded&&-1===r.indexOf(e)?u.push(o.handleAsyncRowExpand(e)):s.push(e)}}):_xeUtils.default.remove(s,function(e){return-1<g.indexOf(e)})}return this.rowExpandeds=s,Promise.all(u).then(this.recalculate)},hasRowExpand:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["hasRowExpand","isExpandByRow"]),this.isExpandByRow(e)},isExpandByRow:function(e){return-1<this.rowExpandeds.indexOf(e)},clearRowExpand:function(){var e=this,t=this.rowExpandeds.length;return this.rowExpandeds=[],this.$nextTick().then(function(){return t?e.recalculate():0})},getRowExpandRecords:function(){return this.rowExpandeds.slice(0)},getTreeExpandRecords:function(){return this.treeExpandeds.slice(0)},getTreeStatus:function(){return this.treeConfig?{config:this.treeOpts,rowExpandeds:this.getTreeExpandRecords()}:null},isTreeExpandLoaded:function(e){var t=this.fullAllDataRowMap.get(e);return t&&t.treeLoaded},clearTreeExpandLoaded:function(t){var e=this.treeOpts,o=this.treeExpandeds,i=this.fullAllDataRowMap,r=e.lazy,l=i.get(t);return r&&l&&(l.treeLoaded=!1,_xeUtils.default.remove(o,function(e){return t===e})),this.$nextTick()},reloadTreeChilds:function(e){var t=this,o=this.treeOpts,i=this.treeLazyLoadeds,r=o.lazy,l=o.hasChild;return r&&e[l]&&-1===i.indexOf(e)&&this.clearTreeExpandLoaded(e).then(function(){return t.handleAsyncTreeExpandChilds(e)}),this.$nextTick()},triggerTreeExpandEvent:function(e,t){var o=this.$listeners,i=this.treeOpts,r=this.treeLazyLoadeds,l=this.expandColumn,n=t.row;if(!i.lazy||-1===r.indexOf(n)){var s=!this.isTreeExpandByRow(n),a=this.getColumnIndex(l),c=this.$getColumnIndex(l);this.setTreeExpand(n,s),o["toggle-tree-change"]?(_tools.UtilTools.warn("vxe.error.delEvent",["toggle-tree-change","toggle-tree-expand"]),this.emitEvent("toggle-tree-change",{expanded:s,column:l,columnIndex:a,$columnIndex:c,row:n},e)):this.emitEvent("toggle-tree-expand",{expanded:s,column:l,columnIndex:a,$columnIndex:c,row:n},e)}},toggleTreeExpansion:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["toggleTreeExpansion","toggleTreeExpand"]),this.toggleTreeExpand(e)},toggleTreeExpand:function(e){return this.setTreeExpand(e,!this.isTreeExpandByRow(e))},handleDefaultTreeExpand:function(){var e=this.treeConfig,o=this.treeOpts,i=this.tableFullData;if(e){var t=o.expandAll,r=o.expandRowKeys;if(t)this.setAllTreeExpand(!0);else if(r){var l=[],n=_tools.UtilTools.getRowkey(this);r.forEach(function(t){var e=_xeUtils.default.findTree(i,function(e){return t===_xeUtils.default.get(e,n)},o);e&&l.push(e.item)}),this.setTreeExpand(l,!0)}}},handleAsyncTreeExpandChilds:function(o){var i=this,e=this.fullAllDataRowMap,r=this.treeExpandeds,t=this.treeOpts,l=this.treeLazyLoadeds,n=this.checkboxOpts,s=t.loadMethod,a=t.children,c=n.checkStrictly,h=e.get(o);return new Promise(function(t){l.push(o),s({$table:i,row:o}).catch(function(){return[]}).then(function(e){h.treeLoaded=!0,_xeUtils.default.remove(l,function(e){return e===o}),_xeUtils.default.isArray(e)||(e=[]),e&&(o[a]=e,i.appendTreeCache(o,e),e.length&&-1===r.indexOf(o)&&r.push(o),!c&&i.isCheckedByCheckboxRow(o)&&i.setCheckboxRow(e,!0)),t(i.$nextTick().then(i.recalculate))})})},setAllTreeExpansion:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["setAllTreeExpansion","setAllTreeExpand"]),this.setAllTreeExpand(e)},setAllTreeExpand:function(e){var t=this.tableFullData,o=this.treeOpts,i=o.lazy,r=o.children,l=[];return _xeUtils.default.eachTree(t,function(e){var t=e[r];(i||t&&t.length)&&l.push(e)},o),this.setTreeExpand(l,e)},setTreeExpansion:function(e,t){return _tools.UtilTools.warn("vxe.error.delFunc",["setTreeExpansion","setTreeExpand"]),this.setTreeExpand(e,t)},setTreeExpand:function(t,o){var i=this,r=this.fullAllDataRowMap,e=this.tableFullData,l=this.treeExpandeds,n=this.treeOpts,s=this.treeLazyLoadeds,a=this.expandColumn,c=n.lazy,h=n.hasChild,u=n.children,d=n.accordion,f=n.toggleMethod,g=[],x=this.getColumnIndex(a),v=this.$getColumnIndex(a);if(t&&(_xeUtils.default.isArray(t)||(t=[t]),t.length)){if(d){t=t.slice(t.length-1,t.length);var p=_xeUtils.default.findTree(e,function(e){return e===t[0]},n);_xeUtils.default.remove(l,function(e){return-1<p.items.indexOf(e)})}var w=f?t.filter(function(e){return f({expanded:o,column:a,columnIndex:x,$columnIndex:v,row:e})}):t;return o?w.forEach(function(e){if(-1===l.indexOf(e)){var t=r.get(e);c&&e[h]&&!t.treeLoaded&&-1===s.indexOf(e)?g.push(i.handleAsyncTreeExpandChilds(e)):e[u]&&e[u].length&&l.push(e)}}):_xeUtils.default.remove(l,function(e){return-1<w.indexOf(e)}),Promise.all(g).then(this.recalculate)}return Promise.resolve()},hasTreeExpand:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["hasTreeExpand","isTreeExpandByRow"]),this.isTreeExpandByRow(e)},isTreeExpandByRow:function(e){return-1<this.treeExpandeds.indexOf(e)},clearTreeExpand:function(){var e=this,t=this.treeExpandeds.length;return this.treeExpandeds=[],this.$nextTick().then(function(){return t?e.recalculate():0})},getVirtualScroller:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getVirtualScroller","getScroll"]),this.getScroll()},getTableScroll:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getTableScroll","getScroll"]),this.getScroll()},getScroll:function(){var e=this.$refs,t=this.scrollXLoad,o=this.scrollYLoad,i=e.tableBody.$el;return{virtualX:t,virtualY:o,scrollTop:i.scrollTop,scrollLeft:i.scrollLeft}},triggerScrollXEvent:function(){this.loadScrollXData()},loadScrollXData:function(e){for(var t=this.$refs,o=this.visibleColumn,i=this.scrollXStore,r=i.startIndex,l=i.renderSize,n=i.offsetSize,s=i.visibleSize,a=t.tableBody.$el.scrollLeft,c=0,h=0,u=e||!1,d=o.length,f=0;f<d;f++)if(a<(h+=o[f].renderWidth)){c=f;break}if(e||i.visibleIndex!==c){var g=Math.min(Math.floor((l-s)/2),s);i.visibleIndex===c?i.startIndex=c:i.visibleIndex>c?(u=c-n<=r)&&(i.startIndex=Math.max(0,Math.max(0,c-g))):(u=r+l<=c+s+n)&&(i.startIndex=Math.max(0,Math.min(o.length-l,c-g))),u&&this.updateScrollXData(),i.visibleIndex=c}this.clostTooltip()},triggerScrollYEvent:function(e){isWebkit&&this.scrollYStore.adaptive?this.loadScrollYData(e):this.debounceScrollY(e)},debounceScrollY:_xeUtils.default.debounce(function(e){this.loadScrollYData(e)},debounceScrollYDuration,{leading:!1,trailing:!0}),loadScrollYData:function(e){var t=this.afterFullData,o=this.scrollYStore,i=this.isLoadData,r=o.startIndex,l=o.renderSize,n=o.offsetSize,s=o.visibleSize,a=o.rowHeight,c=e.target.scrollTop,h=Math.ceil(c/a),u=!1;if(i||o.visibleIndex!==h){var d=Math.min(Math.floor((l-s)/2),s);o.visibleIndex>h?(u=h-n<=r)&&(o.startIndex=Math.max(0,h-Math.max(d,l-s))):(u=r+l<=h+s+n)&&(o.startIndex=Math.max(0,Math.min(t.length-l,h-d))),u&&this.updateScrollYData(),o.visibleIndex=h,this.isLoadData=!1}},computeRowHeight:function(){var e,t=this.$refs.tableBody,o=t?t.$el:null,i=this.$refs.tableHeader;if(o){var r=o.querySelector("tbody>tr");!r&&i&&(r=i.$el.querySelector("thead>tr")),r&&(e=r.clientHeight)}e||(e=this.rowHeightMaps[this.vSize||"default"]),this.rowHeight=e},computeScrollLoad:function(){var b=this;return this.$nextTick().then(function(){var e=b.vSize,t=b.scrollXLoad,o=b.scrollYLoad,i=b.sYOpts,r=b.scrollYStore,l=b.sXOpts,n=b.scrollXStore,s=b.visibleColumn,a=b.rowHeightMaps,c=b.$refs.tableBody,h=c?c.$el:null,u=b.$refs.tableHeader;if(h){if(t){var d=h.clientWidth,f=_xeUtils.default.toNumber(l.vSize);if(!l.vSize)for(var g=f=s.length,x=0,v=0;v<g;v++)if(d<(x+=s[v].renderWidth)){f=v+1;break}n.visibleSize=f,l.oSize||(n.offsetSize=f),l.rSize||(n.renderSize=Math.max(8,f+6)),b.updateScrollXData()}else b.updateScrollXSpace();if(o){var p;if(i.rHeight)p=i.rHeight;else{var w=h.querySelector("tbody>tr");!w&&u&&(w=u.$el.querySelector("thead>tr")),w&&(p=w.clientHeight)}p||(p=a[e||"default"]);var m=_xeUtils.default.toNumber(i.vSize||Math.ceil(h.clientHeight/p));r.visibleSize=m,r.rowHeight=p,i.oSize||(r.offsetSize=m),i.rSize||(r.renderSize=Math.max(6,browse.edge?10*m:isWebkit?m+2:6*m)),b.updateScrollYData()}else b.updateScrollYSpace()}b.$nextTick(b.updateStyle)})},updateScrollXData:function(){var e=this.visibleColumn,t=this.scrollXStore;this.tableColumn=e.slice(t.startIndex,t.startIndex+t.renderSize),this.updateScrollXSpace()},updateScrollXSpace:function(){var e=this.$refs,i=this.elemStore,t=this.visibleColumn,o=this.scrollXStore,r=this.scrollXLoad,l=this.tableWidth,n=this.scrollbarWidth,s=e.tableHeader,a=e.tableBody,c=e.tableFooter,h=s?s.$el.querySelector(".vxe-table--header"):null,u=a.$el.querySelector(".vxe-table--body"),d=c?c.$el.querySelector(".vxe-table--footer"):null,f=t.slice(0,o.startIndex).reduce(function(e,t){return e+t.renderWidth},0),g="";r&&(g="".concat(f,"px")),h&&(h.style.marginLeft=g),u.style.marginLeft=g,d&&(d.style.marginLeft=g);["main"].forEach(function(o){["header","body","footer"].forEach(function(e){var t=i["".concat(o,"-").concat(e,"-xSpace")];t&&(t.style.width=r?"".concat(l+("header"===e?n:0),"px"):"")})}),this.$nextTick(this.updateStyle)},updateScrollYData:function(){this.handleTableData(),this.updateScrollYSpace()},updateScrollYSpace:function(){var i=this.elemStore,e=this.scrollYStore,t=this.scrollYLoad,o=this.afterFullData.length*e.rowHeight,r=Math.max(e.startIndex*e.rowHeight,0),l="",n="";t&&(l="".concat(r,"px"),n="".concat(o,"px")),["main","left","right"].forEach(function(o){var e=i["".concat(o,"-body-table")];e&&(e.style.marginTop=l),["header","body","footer"].forEach(function(e){var t=i["".concat(o,"-").concat(e,"-ySpace")];t&&(t.style.height=n)})}),this.$nextTick(this.updateStyle)},scrollTo:function(e,t){var o,i=this,r=this.$refs,l=r.tableBody.$el;if(_xeUtils.default.isNumber(e)){var n=r.tableFooter?r.tableFooter.$el:null;n?(n.scrollLeft=e,_tools.DomTools.triggerEvent(n,"scroll")):(o=!0,l.scrollLeft=e)}if(_xeUtils.default.isNumber(t)){var s=r.rightBody?r.rightBody.$el:null;s?(s.scrollTop=t,_tools.DomTools.triggerEvent(s,"scroll")):(o=!0,l.scrollTop=t)}return o&&_tools.DomTools.triggerEvent(l,"scroll"),this.scrollXLoad||this.scrollYLoad?new Promise(function(e){return setTimeout(function(){return e(i.$nextTick())},50)}):this.$nextTick()},scrollToRow:function(e,t){var o=[];return e&&(this.treeConfig?o.push(this.scrollToTreeRow(e)):o.push(_tools.DomTools.rowToVisible(this,e))),o.push(this.scrollToColumn(t)),Promise.all(o)},scrollToColumn:function(e){return e&&this.fullColumnMap.has(e)?_tools.DomTools.colToVisible(this,e):this.$nextTick()},scrollToTreeRow:function(t){var o=this,e=this.tableFullData,i=this.treeConfig,r=this.treeOpts;if(i){var l=_xeUtils.default.findTree(e,function(e){return e===t},r);if(l){var n=l.nodes;n.forEach(function(e,t){t<n.length-1&&!o.isTreeExpandByRow(e)&&o.setTreeExpand(e,!0)})}}return this.$nextTick()},clearScroll:function(){var t=this,e=this.$refs,o=e.tableBody,i=o?o.$el:null,r=e.tableFooter,l=(r?r.$el:null)||i;return i&&(i.scrollTop=0),l&&(l.scrollLeft=0),new Promise(function(e){return setTimeout(function(){return e(t.$nextTick())})})},updateFooter:function(){var e=this.showFooter,t=this.visibleColumn,o=this.footerMethod;return e&&o&&(this.footerData=t.length?o({columns:t,data:this.afterFullData}):[]),this.$nextTick()},updateStatus:function(a,c){var h=this,u=!_xeUtils.default.isUndefined(c);return this.$nextTick().then(function(){var e=h.$refs,t=h.tableData,o=h.editRules,i=h.validStore;if(a&&e.tableBody&&o){var r=a.row,l=a.column;if(h.hasCellRules("change",r,l)){var n=t.indexOf(r),s=_tools.DomTools.getCell(h,{row:r,rowIndex:n,column:l});if(s)return h.validCellRules("change",r,l,c).then(function(){u&&i.visible&&_tools.UtilTools.setCellValue(r,l,c),h.clearValidate()}).catch(function(e){var t=e.rule;u&&_tools.UtilTools.setCellValue(r,l,c),h.showValidTooltip({rule:t,row:r,column:l,cell:s})})}}})},updateZindex:function(){this.zIndex?this.tZindex=this.zIndex:this.tZindex<_tools.UtilTools.getLastZIndex()&&(this.tZindex=_tools.UtilTools.nextZIndex())},emitEvent:function(e,t,o){this.$emit(e,Object.assign({$table:this,$grid:this.$xegrid,$event:o},t),o)},focus:function(){return this.isActivated=!0,this.$nextTick()},blur:function(){return this.isActivated=!1,this.$nextTick()},getEventTargetNode:_tools.DomTools.getEventTargetNode,connect:function(e){e&&e.syncUpdate?(e.syncUpdate({collectColumn:this.collectColumn,$table:this}),this.$toolbar=e):_tools.UtilTools.error("vxe.error.barUnableLink")}},funcs="setFilter,filter,clearFilter,closeMenu,getMouseSelecteds,getMouseCheckeds,getSelectedCell,getSelectedRanges,clearCopyed,clearChecked,clearHeaderChecked,clearIndexChecked,clearSelected,insert,insertAt,remove,removeSelecteds,removeCheckboxRow,removeRadioRow,removeCurrentRow,getRecordset,getInsertRecords,getRemoveRecords,getUpdateRecords,clearActived,getActiveRecord,getActiveRow,hasActiveRow,isActiveByRow,setActiveRow,setActiveCell,setSelectCell,clearValidate,fullValidate,validate,exportCsv,openExport,exportData,openImport,importData,readFile,importByFile,print".split(",");funcs.forEach(function(e){Methods[e]=function(){return this["_".concat(e)]?this["_".concat(e)].apply(this,arguments):null}});var _default=Methods;exports.default=_default;