"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils/methods/xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_vXETable=_interopRequireDefault(require("../../v-x-e-table")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var htmlCellElem,fileForm,fileInput,printFrame,defaultHtmlStyle='body{margin:0;}body *{-webkit-box-sizing:border-box;box-sizing:border-box}.vxe-table{border:0;border-collapse:separate;text-align:left;font-size:14px;border-spacing:0}.vxe-table:not(.is--print ){table-layout:fixed;}.vxe-table.is--print{width:100%}.vxe-table.border--default,.vxe-table.border--full,.vxe-table.border--outer{border-top:1px solid #e8eaec;}.vxe-table.border--default,.vxe-table.border--full,.vxe-table.border--outer{border-left:1px solid #e8eaec;}.vxe-table.border--outer,.vxe-table.border--default th,.vxe-table.border--default td,.vxe-table.border--full th,.vxe-table.border--full td,.vxe-table.border--outer th,.vxe-table.border--inner th,.vxe-table.border--inner td{border-bottom:1px solid #e8eaec}.vxe-table.border--default,.vxe-table.border--outer,.vxe-table.border--full th,.vxe-table.border--full td{border-right:1px solid #e8eaec}.vxe-table.border--default th,.vxe-table.border--full th,.vxe-table.border--outer th{background-color:#f8f8f9;}.vxe-table td>div,.vxe-table th>div{padding:.5em .4em}.col--center{text-align:center}.col--right{text-align:right}.vxe-table:not(.is--print ) .col--ellipsis>div{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;word-break:break-all}.vxe-table--tree-node{text-align:left}.vxe-table--tree-node-wrapper{position:relative}.vxe-table--tree-icon-wrapper{position:absolute;top:50%;width:1em;height:1em;text-align:center;-webkit-transform:translateY(-50%);transform:translateY(-50%);-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer}.vxe-table--tree-icon{position:absolute;left:0;top:.3em;width:0;height:0;border-style:solid;border-width:.5em;border-top-color:#939599;border-right-color:transparent;border-bottom-color:transparent;border-left-color:transparent}.vxe-table--tree-cell{display:block;padding-left:1.5em}.vxe-table input[type="checkbox"],.vxe-table input[type="radio"],.vxe-table input[type="checkbox"]+span,.vxe-table input[type="radio"]+span{vertical-align:middle;}';function createFrame(){var e=document.createElement("iframe");return e.className="vxe-table--print-frame",e}function hasTreeChildren(e,t){var o=e.treeOpts;return t[o.children]&&t[o.children].length}function getSeq(e,t,o,r,a){var l=e.seqOpts,n=l.seqMethod||r.seqMethod||r.indexMethod;return n?n({row:t,rowIndex:o,column:r,columnIndex:a}):(l.startIndex||e.startIndex)+o+1}function defaultFilterExportColumn(e){return e.property||-1<["seq","checkbox","radio"].indexOf(e.type)}function toTableBorder(e){return!0===e?"full":e||"default"}function getLabelData(p,f,a,e){var t=p.treeConfig,o=p.treeOpts,m=p.scrollXLoad,h=p.scrollYLoad,b=p.radioOpts,v=p.checkboxOpts;if(htmlCellElem||(htmlCellElem=document.createElement("div")),t){var l=[];return _xeUtils.default.eachTree(e,function(c,s,e,t,o,r){var d={_level:r.length-1,_hasChild:hasTreeChildren(p,c)};a.forEach(function(e,t){var o="";switch(e.type){case"seq":case"index":o=getSeq(p,c,s,e,t);break;case"selection":case"checkbox":o=p.isCheckedByCheckboxRow(c),d._checkboxLabel=v.labelField?_xeUtils.default.get(c,v.labelField):"",d._checkboxDisabled=v.checkMethod&&!v.checkMethod({row:c});break;case"radio":o=p.isCheckedByRadioRow(c),d._radioLabel=b.labelField?_xeUtils.default.get(c,b.labelField):"",d._radioDisabled=b.checkMethod&&!b.checkMethod({row:c});break;default:if(f.original)o=_tools.UtilTools.getCellValue(c,e);else{var r,a=e.cellRender,l=e.editRender;if(l&&l.name){var n=_vXETable.default.renderer.get(l.name);n&&(r=n.editCellExportMethod)}else if(a&&a.name){var i=_vXETable.default.renderer.get(a.name);i&&(r=i.cellExportMethod)}r?o=r({$table:p,row:c,column:e}):(o=_tools.UtilTools.getCellLabel(c,e,{$table:p}),"html"===e.type&&(htmlCellElem.innerHTML=o,o=htmlCellElem.innerText.trim()))}}d[e.id]=_xeUtils.default.toString(o)}),l.push(Object.assign(d,c))},o),l}return e.map(function(s,d){var u={};return a.forEach(function(e,t){var o="";switch(e.type){case"seq":case"index":o=getSeq(p,s,d,e,t);break;case"selection":case"checkbox":o=p.isCheckedByCheckboxRow(s),u._checkboxLabel=v.labelField?_xeUtils.default.get(s,v.labelField):"",u._checkboxDisabled=v.checkMethod&&!v.checkMethod({row:s});break;case"radio":o=p.isCheckedByRadioRow(s),u._radioLabel=b.labelField?_xeUtils.default.get(s,b.labelField):"",u._radioDisabled=b.checkMethod&&!b.checkMethod({row:s});break;default:if(f.original)o=_tools.UtilTools.getCellValue(s,e);else if(m||h){var r,a=e.cellRender,l=e.editRender;if(l&&l.name){var n=_vXETable.default.renderer.get(l.name);n&&(r=n.editCellExportMethod)}else if(a&&a.name){var i=_vXETable.default.renderer.get(a.name);i&&(r=i.cellExportMethod)}r?o=r({$table:p,row:s,column:e}):(o=_tools.UtilTools.getCellLabel(s,e,{$table:p}),"html"===e.type&&(htmlCellElem.innerHTML=o,o=htmlCellElem.innerText.trim()))}else{var c=_tools.DomTools.getCell(p,{row:s,column:e});o=c?c.innerText.trim():_tools.UtilTools.getCellLabel(s,e,{$table:p})}}u[e.id]=_xeUtils.default.toString(o)}),u})}function getExportData(e,t){var o=t.columns,r=t.data;return t.columnFilterMethod&&(o=o.filter(t.columnFilterMethod)),t.dataFilterMethod&&(r=r.filter(t.dataFilterMethod)),{columns:o,datas:getLabelData(e,t,o,r)}}function getHeaderTitle(e,t){return(e.original?t.property:t.getTitle())||""}function getFooterCellValue(e,t,o,r){var a,l=r.cellRender,n=r.editRender;if(n&&n.name){var i=_vXETable.default.renderer.get(n.name);i&&(a=i.footerCellExportMethod)}else if(l&&l.name){var c=_vXETable.default.renderer.get(l.name);c&&(a=c.footerCellExportMethod)}var s=e._getColumnIndex(r);return a?a({$table:e,items:o,itemIndex:s,_columnIndex:s,column:r}):_xeUtils.default.toString(o[s])}function toCsv(o,r,e,t){var a="\ufeff";if(r.isHeader&&(a+=e.map(function(e){return'"'.concat(getHeaderTitle(r,e),'"')}).join(",")+"\n"),t.forEach(function(t){a+=e.map(function(e){return'"'.concat(t[e.id],'"')}).join(",")+"\n"}),r.isFooter){var l=o.footerData;(r.footerFilterMethod?l.filter(r.footerFilterMethod):l).forEach(function(t){a+=e.map(function(e){return'"'.concat(getFooterCellValue(o,r,t,e),'"')}).join(",")+"\n"})}return a}function toTxt(o,r,e,t){var a="";if(r.isHeader&&(a+=e.map(function(e){return"".concat(getHeaderTitle(r,e))}).join("\t")+"\n"),t.forEach(function(t){a+=e.map(function(e){return"".concat(t[e.id])}).join("\t")+"\n"}),r.isFooter){var l=o.footerData;(r.footerFilterMethod?l.filter(r.footerFilterMethod):l).forEach(function(t){a+=e.map(function(e){return"".concat(getFooterCellValue(o,r,t,e))}).join(",")+"\n"})}return a}function hasEllipsis(e,t,o,r){var a=t[o],l=_xeUtils.default.isUndefined(a)||_xeUtils.default.isNull(a)?r:a,n="title"===l||(!0===l||"tooltip"===l)||"ellipsis"===l;return!e.scrollXLoad&&!e.scrollYLoad||n||(n=!0),n}function toHtml(n,l,e,t){var i=n.id,o=n.border,r=n.treeConfig,c=n.treeOpts,a=n.isAllSelected,s=n.isIndeterminate,d=n.headerAlign,u=n.align,p=n.footerAlign,f=n.showOverflow,m=n.showHeaderOverflow,h=l.print,b="check-all",v=["vxe-table","border--".concat(toTableBorder(o)),h?"is--print":"",l.isHeader?"show--head":""].filter(function(e){return e}),x=["<html>","<head>",'<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no,minimal-ui"><title>'.concat(l.sheetName,"</title>"),"<style>".concat(l.style||defaultHtmlStyle,"</style>"),"</head>","<body>",'<table class="'.concat(v.join(" "),'" border="0" cellspacing="0" cellpadding="0">'),"<colgroup>".concat(e.map(function(e){return'<col style="width:'.concat(e.renderWidth,'px">')}).join(""),"</colgroup>")].join("");if(l.isHeader&&(x+="<thead><tr>".concat(e.map(function(e){var t=e.headerAlign||e.align||d||u,o=hasEllipsis(n,e,"showHeaderOverflow",m)?["col--ellipsis"]:[],r=getHeaderTitle(l,e);return t&&o.push("col--".concat(t)),"checkbox"===e.type||"selection"===e.type?'<td class="'.concat(o.join(" "),'"><div ').concat(h?"":'style="width: '.concat(e.renderWidth,'px"'),'><input type="checkbox" class="').concat(b,'" ').concat(a?"checked":"","><span>").concat(r,"</span></div></td>"):'<th class="'.concat(o.join(" "),'" title="').concat(r,'"><div ').concat(h?"":'style="width: '.concat(e.renderWidth,'px"'),"><span>").concat(r,"</span></div></th>")}).join(""),"</tr></thead>")),t.length&&(x+="<tbody>",r?t.forEach(function(l){x+="<tr>"+e.map(function(e){var t=e.align||u,o=hasEllipsis(n,e,"showOverflow",f)?["col--ellipsis"]:[],r=l[e.id];if(t&&o.push("col--".concat(t)),e.treeNode){var a="";return l._hasChild&&(a='<i class="vxe-table--tree-icon"></i>'),o.push("vxe-table--tree-node"),"radio"===e.type?'<td class="'.concat(o.join(" "),'" title="').concat(r,'"><div ').concat(h?"":'style="width: '.concat(e.renderWidth,'px"'),'><div class="vxe-table--tree-node-wrapper" style="padding-left: ').concat(l._level*c.indent,'px"><div class="vxe-table--tree-icon-wrapper">').concat(a,'</div><div class="vxe-table--tree-cell"><input type="radio" name="radio_').concat(i,'" ').concat(l._radioDisabled?"disabled ":"").concat(!0===r||"true"===r?"checked":"","><span>").concat(l._radioLabel,"</span></div></div></div></td>"):"checkbox"===e.type||"selection"===e.type?'<td class="'.concat(o.join(" "),'" title="').concat(r,'"><div ').concat(h?"":'style="width: '.concat(e.renderWidth,'px"'),'><div class="vxe-table--tree-node-wrapper" style="padding-left: ').concat(l._level*c.indent,'px"><div class="vxe-table--tree-icon-wrapper">').concat(a,'</div><div class="vxe-table--tree-cell"><input type="checkbox" ').concat(l._checkboxDisabled?"disabled ":"").concat(!0===r||"true"===r?"checked":"","><span>").concat(l._checkboxLabel,"</span></div></div></div></td>"):'<td class="'.concat(o.join(" "),'" title="').concat(r,'"><div ').concat(h?"":'style="width: '.concat(e.renderWidth,'px"'),'><div class="vxe-table--tree-node-wrapper" style="padding-left: ').concat(l._level*c.indent,'px"><div class="vxe-table--tree-icon-wrapper">').concat(a,'</div><div class="vxe-table--tree-cell">').concat(r,"</div></div></div></td>")}return"radio"===e.type?'<td class="'.concat(o.join(" "),'"><div ').concat(h?"":'style="width: '.concat(e.renderWidth,'px"'),'><input type="radio" name="radio_').concat(i,'" ').concat(l._radioDisabled?"disabled ":"").concat(!0===r||"true"===r?"checked":"","><span>").concat(l._radioLabel,"</span></div></td>"):"checkbox"===e.type||"selection"===e.type?'<td class="'.concat(o.join(" "),'"><div ').concat(h?"":'style="width: '.concat(e.renderWidth,'px"'),'><input type="checkbox" ').concat(l._checkboxDisabled?"disabled ":"").concat(!0===r||"true"===r?"checked":"","><span>").concat(l._checkboxLabel,"</span></div></td>"):'<td class="'.concat(o.join(" "),'" title="').concat(r,'"><div ').concat(h?"":'style="width: '.concat(e.renderWidth,'px"'),">").concat(r,"</div></td>")}).join("")+"</tr>"}):t.forEach(function(a){x+="<tr>"+e.map(function(e){var t=e.align||u,o=hasEllipsis(n,e,"showOverflow",f)?["col--ellipsis"]:[],r=a[e.id];return t&&o.push("col--".concat(t)),"radio"===e.type?'<td class="'.concat(o.join(" "),'"><div ').concat(h?"":'style="width: '.concat(e.renderWidth,'px"'),'><input type="radio" name="radio_').concat(i,'" ').concat(a._radioDisabled?"disabled ":"").concat(!0===r||"true"===r?"checked":"","><span>").concat(a._radioLabel,"</span></div></td>"):"checkbox"===e.type||"selection"===e.type?'<td class="'.concat(o.join(" "),'"><div ').concat(h?"":'style="width: '.concat(e.renderWidth,'px"'),'><input type="checkbox" ').concat(a._checkboxDisabled?"disabled ":"").concat(!0===r||"true"===r?"checked":"","><span>").concat(a._checkboxLabel,"</span></div></td>"):'<td class="'.concat(o.join(" "),'" title="').concat(r,'"><div ').concat(h?"":'style="width: '.concat(e.renderWidth,'px"'),">").concat(r,"</div></td>")}).join("")+"</tr>"}),x+="</tbody>"),l.isFooter){var g=n.footerData,y=l.footerFilterMethod?g.filter(l.footerFilterMethod):g;y.length&&(x+="<tfoot>",y.forEach(function(a){x+="<tr>".concat(e.map(function(e){var t=e.footerAlign||e.align||p||u,o=hasEllipsis(n,e,"showOverflow",f)?["col--ellipsis"]:[],r=getFooterCellValue(n,l,a,e);return t&&o.push("col--".concat(t)),'<td class="'.concat(o.join(" "),'" title="').concat(r,'"><div ').concat(h?"":'style="width: '.concat(e.renderWidth,'px"'),">").concat(r,"</div></td>")}).join(""),"</tr>")}),x+="</tfoot>")}var _=!a&&s?'<script>(function(){var a=document.querySelector(".'.concat(b,'");if(a){a.indeterminate=true}})()<\/script>'):"";return x+"</table>".concat(_,"</body></html>")}function toXML(o,r,e,t){var a=['<?xml version="1.0"?>','<?mso-application progid="Excel.Sheet"?>','<Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet" xmlns:html="http://www.w3.org/TR/REC-html40">','<DocumentProperties xmlns="urn:schemas-microsoft-com:office:office">',"<Version>16.00</Version>","</DocumentProperties>",'<ExcelWorkbook xmlns="urn:schemas-microsoft-com:office:excel">',"<WindowHeight>7920</WindowHeight>","<WindowWidth>21570</WindowWidth>","<WindowTopX>32767</WindowTopX>","<WindowTopY>32767</WindowTopY>","<ProtectStructure>False</ProtectStructure>","<ProtectWindows>False</ProtectWindows>","</ExcelWorkbook>",'<Worksheet ss:Name="'.concat(r.sheetName,'">'),"<Table>",e.map(function(e){return'<Column ss:Width="'.concat(e.renderWidth,'"/>')}).join("")].join("");if(r.isHeader&&(a+="<Row>".concat(e.map(function(e){return'<Cell><Data ss:Type="String">'.concat(getHeaderTitle(r,e),"</Data></Cell>")}).join(""),"</Row>")),t.forEach(function(t){a+="<Row>"+e.map(function(e){return'<Cell><Data ss:Type="String">'.concat(t[e.id],"</Data></Cell>")}).join("")+"</Row>"}),r.isFooter){var l=o.footerData;(r.footerFilterMethod?l.filter(r.footerFilterMethod):l).forEach(function(t){a+="<Row>".concat(e.map(function(e){return'<Cell><Data ss:Type="String">'.concat(getFooterCellValue(o,r,t,e),"</Data></Cell>")}).join(""),"</Row>")})}return"".concat(a,"</Table></Worksheet></Workbook>")}function getContent(e,t,o,r){switch(t.type){case"csv":return toCsv(e,t,o,r);case"txt":return toTxt(e,t,o,r);case"html":return toHtml(e,t,o,r);case"xml":return toXML(e,t,o,r)}return""}function downloadFile(e,t,o){var r=t.filename,a=t.type,l=t.download,n="".concat(r,".").concat(a);if(window.Blob){var i=new Blob([o],{type:"text/".concat(a)});if(!l)return Promise.resolve({type:a,content:o,blob:i});if(navigator.msSaveBlob)navigator.msSaveBlob(i,n);else{var c=document.createElement("a");c.target="_blank",c.download=n,c.href=URL.createObjectURL(i),document.body.appendChild(c),c.click(),document.body.removeChild(c)}!1!==t.message&&_vXETable.default.modal.message({message:_conf.default.i18n("vxe.table.expSuccess"),status:"success"})}else _tools.UtilTools.error("vxe.error.notExp")}function handleExport(e,t){var o=getExportData(e,t),r=o.columns,a=o.datas;return Promise.resolve(e.preventEvent(null,"event.export",{options:t,columns:r,datas:a},function(){return downloadFile(e,t,getContent(e,t,r,a))}))}function getElementsByTagName(e,t){return e.getElementsByTagName(t)}function replaceDoubleQuotation(e){return e.replace(/^"/,"").replace(/"$/,"")}function parseCsv(e,t){var o=t.split("\n"),r=[],a=[];if(o.length){var l=o.slice(1);a=o[0].split(",").map(replaceDoubleQuotation),l.forEach(function(e){if(e){var o={};e.split(",").forEach(function(e,t){a[t]&&(o[a[t]]=replaceDoubleQuotation(e))}),r.push(o)}})}return{fields:a,rows:r}}function parseTxt(e,t){var o=t.split("\n"),r=[],a=[];if(o.length){var l=o.slice(1);a=o[0].split("\t"),l.forEach(function(e){if(e){var o={};e.split("\t").forEach(function(e,t){a[t]&&(o[a[t]]=replaceDoubleQuotation(e))}),r.push(o)}})}return{fields:a,rows:r}}function parseHTML(e,t){var o=getElementsByTagName((new DOMParser).parseFromString(t,"text/html"),"body"),r=[],a=[];if(o.length){var l=getElementsByTagName(o[0],"table");if(l.length){var n=getElementsByTagName(l[0],"thead");if(n.length){_xeUtils.default.arrayEach(getElementsByTagName(n[0],"tr"),function(e){_xeUtils.default.arrayEach(getElementsByTagName(e,"th"),function(e){a.push(e.textContent)})});var i=getElementsByTagName(l[0],"tbody");i.length&&_xeUtils.default.arrayEach(getElementsByTagName(i[0],"tr"),function(e){var o={};_xeUtils.default.arrayEach(getElementsByTagName(e,"td"),function(e,t){a[t]&&(o[a[t]]=e.textContent||"")}),r.push(o)})}}}return{fields:a,rows:r}}function parseXML(e,t){var o=getElementsByTagName((new DOMParser).parseFromString(t,"application/xml"),"Worksheet"),a=[],l=[];if(o.length){var r=getElementsByTagName(o[0],"Table");if(r.length){var n=getElementsByTagName(r[0],"Row");n.length&&(_xeUtils.default.arrayEach(getElementsByTagName(n[0],"Cell"),function(e){l.push(e.textContent)}),_xeUtils.default.arrayEach(n,function(e,t){if(t){var o={},r=getElementsByTagName(e,"Cell");_xeUtils.default.arrayEach(r,function(e,t){l[t]&&(o[l[t]]=e.textContent)}),a.push(o)}}))}}return{fields:l,rows:a}}function checkImportData(e,t){var o=[];return e.forEach(function(e){var t=e.property;t&&o.push(t)}),o.every(function(e){return-1<t.indexOf(e)})}function handleImport(t,e,o){var r=t.tableFullColumn,a=t._importResolve,l={fields:[],rows:[]};switch(o.type){case"csv":l=parseCsv(r,e);break;case"txt":l=parseTxt(r,e);break;case"html":l=parseHTML(r,e);break;case"xml":l=parseXML(r,e)}var n=l,i=n.fields,c=n.rows,s=checkImportData(r,i);s?(t.createData(c).then(function(e){"insert"===o.mode?t.insert(e):t.reloadData(e)}),!1!==o.message&&_vXETable.default.modal.message({message:_xeUtils.default.template(_conf.default.i18n("vxe.table.impSuccess"),[c.length]),status:"success"})):!1!==o.message&&_vXETable.default.modal.message({message:_conf.default.i18n("vxe.error.impFields"),status:"error"}),a&&(a(s),t._importResolve=null)}var _default={methods:{_exportCsv:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["exportCsv","exportData"]),this.exportData(e)},_exportData:function(e){var t=this.visibleColumn,o=this.tableFullData,r=this.treeConfig,a=this.treeOpts,l=this.exportOpts,n=Object.assign({isHeader:!0,isFooter:!0,download:!0,type:"csv",mode:"current",columns:t,columnFilterMethod:e&&e.columns?null:function(e){return defaultFilterExportColumn(e)}},l,e);if(n.filename||(n.filename=_xeUtils.default.template(_conf.default.i18n(n.original?"vxe.table.expOriginFilename":"vxe.table.expFilename"),[_xeUtils.default.toDateString(Date.now(),"yyyyMMddHHmmss")])),n.sheetName||(n.sheetName=document.title),-1===_vXETable.default.exportTypes.indexOf(n.type))throw new Error(_tools.UtilTools.getLog("vxe.error.notType",[n.type]));if(!n.data&&(n.data=o,"selected"===n.mode)){var i=this.getCheckboxRecords();-1<["html","pdf"].indexOf(n.type)&&r?n.data=_xeUtils.default.searchTree(this.getTableData().fullData,function(e){return-1<i.indexOf(e)},a):n.data=i}if(n.remote){var c={options:n,$table:this,$grid:this.$xegrid};return n.exportMethod?n.exportMethod(c):Promise.resolve(c)}return handleExport(this,n)},_importByFile:function(t,e){var o=this;if(window.FileReader){var r=_tools.UtilTools.parseFile(t),a=r.type,l=r.filename,n=Object.assign({mode:"insert"},e,{type:a,filename:l});if(-1<(n.types||_vXETable.default.importTypes).indexOf(a)){if(n.remote){var i={file:t,options:n,$table:this};return n.importMethod?n.importMethod(i):Promise.resolve(i)}this.preventEvent(null,"event.import",{file:t,options:n,columns:this.tableFullColumn},function(){var e=new FileReader;e.onerror=function(){_tools.UtilTools.error("vxe.error.notType",[a])},e.onload=function(e){handleImport(o,e.target.result.trim(),n)},e.readAsText(t,"UTF-8")})}else _tools.UtilTools.error("vxe.error.notType",[a])}else _tools.UtilTools.error("vxe.error.notExp");return Promise.resolve()},_importData:function(e){var o=this,t=Object.assign({},this.importOpts,e),r=new Promise(function(e,t){o._importResolve=e,o._importReject=t});return this.readFile(t).then(function(e){return o.importByFile(e.target.files[0],t)}).catch(function(e){o._importReject(e),o._importReject=null}),r},_readFile:function(){var o=this,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};fileForm||(fileForm=document.createElement("form"),fileInput=document.createElement("input"),fileForm.className="vxe-table--file-form",fileInput.name="file",fileInput.type="file",fileForm.appendChild(fileInput),document.body.appendChild(fileForm));var a=r.types||_vXETable.default.importTypes;return r.multiple&&(fileInput.multiple="multiple"),fileInput.accept=".".concat(a.join(", .")),fileInput.onchange=function(e){var t=_tools.UtilTools.parseFile(e.target.files[0]).type;-1<a.indexOf(t)?o._fileResolve(e):(!1!==r.message&&_vXETable.default.modal.message({message:_xeUtils.default.template(_conf.default.i18n("vxe.error.notType"),[t]),status:"error"}),o._fileReject(e)),o._fileResolve=null},fileForm.reset(),fileInput.click(),new Promise(function(e,t){o._fileResolve=e,o._fileReject=t})},_print:function(e){var t=Object.assign({original:!1},e,{type:"html",download:!1,remote:!1,print:!0});t.sheetName||(t.sheetName=t.filename),this.exportData(t).then(function(e){var t=e.content,o=e.blob;if(_tools.DomTools.browse.msie){if(printFrame){try{printFrame.contentDocument.write(""),printFrame.contentDocument.clear()}catch(e){}document.body.removeChild(printFrame)}printFrame=createFrame(),document.body.appendChild(printFrame),printFrame.contentDocument.write(t),printFrame.contentDocument.execCommand("print")}else printFrame||((printFrame=createFrame()).onload=function(e){e.target.src&&e.target.contentWindow.print()},document.body.appendChild(printFrame)),printFrame.src=URL.createObjectURL(o)})},_openImport:function(e){var t=Object.assign({mode:"insert",message:!0},e,this.importOpts),o=t.types||_vXETable.default.exportTypes;if(!!this.getTreeStatus())t.message&&_vXETable.default.modal.message({message:_conf.default.i18n("vxe.error.treeNotImp"),status:"error"});else{this.importConfig||_tools.UtilTools.error("vxe.error.reqProp",["import-config"]);var r=o.map(function(e){return{value:e,label:"vxe.export.types.".concat(e)}}),a=t.modes.map(function(e){return{value:e,label:"vxe.import.modes.".concat(e)}});Object.assign(this.importStore,{file:null,type:"",filename:"",modeList:a,typeList:r,visible:!0}),Object.assign(this.importParams,t)}},_openExport:function(e){var t=this.$toolbar,o=this.exportConfig,r=this.customOpts,a=this.exportOpts,l=this.collectColumn,n=this.footerData,i=this.getCheckboxRecords(),c=!!n.length,s=Object.assign({message:!0,isHeader:!0},a,e),d=s.types||_vXETable.default.exportTypes,u=r.checkMethod||(t?t.customOpts.checkMethod:null),p=l.slice(0);o||_tools.UtilTools.error("vxe.error.reqProp",["export-config"]);var f=d.map(function(e){return{value:e,label:"vxe.export.types.".concat(e)}}),m=s.modes.map(function(e){return{value:e,label:"vxe.export.modes.".concat(e)}});return _xeUtils.default.eachTree(p,function(e,t,o,r,a){(e.children&&e.children.length||defaultFilterExportColumn(e))&&(e.checked=e.visible,e.halfChecked=!1,e.disabled=a&&a.disabled||!!u&&!u({column:e}))}),Object.assign(this.exportStore,{columns:p,typeList:f,modeList:m,hasFooter:c,visible:!0}),Object.assign(this.exportParams,{filename:s.filename||"",sheetName:s.sheetName||"",type:s.type||f[0].value,mode:i.length?"selected":"current",original:s.original,message:s.message,isHeader:s.isHeader,isFooter:c,isPrint:s.isPrint}),this.$nextTick()}}};exports.default=_default;