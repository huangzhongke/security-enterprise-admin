"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils/methods/xe-utils")),_tools=require("../../tools"),_util=require("./util");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,l){return t in e?Object.defineProperty(e,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[t]=l,e}var cellType="header",_default={name:"VxeTableHeader",props:{tableData:Array,tableColumn:Array,visibleColumn:Array,tableGroupColumn:Array,fixedColumn:Array,size:String,fixedType:String,isGroup:Boolean},data:function(){return{headerColumn:[]}},watch:{tableColumn:function(){this.uploadColumn()}},created:function(){this.uploadColumn()},mounted:function(){var e=this.$parent,t=this.$el,l=this.$refs,o=this.fixedType,r=e.elemStore,i="".concat(o||"main","-header-");r["".concat(i,"wrapper")]=t,r["".concat(i,"table")]=l.table,r["".concat(i,"colgroup")]=l.colgroup,r["".concat(i,"list")]=l.thead,r["".concat(i,"xSpace")]=l.xSpace,r["".concat(i,"repair")]=l.repair},render:function(T){var $=this,e=this._e,z=this.$parent,P=this.fixedType,t=this.headerColumn,l=this.fixedColumn,o=this.tableColumn,S=z.$listeners,r=z.tId,D=z.resizable,k=z.border,R=z.columnKey,i=z.headerRowClassName,W=z.headerCellClassName,n=z.headerRowStyle,M=z.headerCellStyle,U=z.showHeaderOverflow,H=z.headerAlign,I=z.align,E=z.highlightCurrentColumn,O=z.currentColumn,a=z.mouseConfig,s=z.mouseOpts,q=z.scrollXLoad,A=z.overflowX,d=z.scrollbarWidth,L=z.getColumnIndex,B=z.tooltipOpts,N=z.sortOpts,X=a&&s.selected,F=a&&(s.range||s.checked);return q&&P&&(o=l),T("div",{class:["vxe-table--header-wrapper",P?"fixed-".concat(P,"--wrapper"):"body--wrapper"],attrs:{"data-tid":r}},[P?e():T("div",{class:"vxe-body--x-space",ref:"xSpace"}),T("table",{class:"vxe-table--header",attrs:{"data-tid":r,cellspacing:0,cellpadding:0,border:0},ref:"table"},[T("colgroup",{ref:"colgroup"},o.map(function(e,t){return T("col",{attrs:{name:e.id},key:t})}).concat(d?[T("col",{attrs:{name:"col_gutter"}})]:[])),T("thead",{ref:"thead"},t.map(function(C,w){return T("tr",{class:["vxe-header--row",i?_xeUtils.default.isFunction(i)?i({$table:z,$rowIndex:w,fixed:P,type:cellType}):i:""],style:n?_xeUtils.default.isFunction(n)?n({$table:z,$rowIndex:w,fixed:P,type:cellType}):n:null},C.map(function(t,e){var l,o=t.showHeaderOverflow,r=t.headerAlign,i=t.align,n=t.headerClassName,a=B.enabled,s=t.children&&t.children.length,d=P?t.fixed!==P&&!s:t.fixed&&A,c=_xeUtils.default.isUndefined(o)||_xeUtils.default.isNull(o)?U:o,u=r||i||H||I,f="ellipsis"===c,p="title"===c,h=!0===c||"tooltip"===c,m=p||h||f,x={},y=t.filters&&t.filters.some(function(e){return e.checked}),g=L(t),v=z._getColumnIndex(t),_={$table:z,$rowIndex:w,column:t,columnIndex:g,$columnIndex:e,_columnIndex:v,fixed:P,type:cellType,isHidden:d,hasFilter:y};q&&!m&&(f=m=!0),(p||h||a)&&(x.mouseenter=function(e){z._isResize||(p?_tools.DomTools.updateCellTitle(e,t):(h||a)&&z.triggerHeaderTooltipEvent(e,_))}),(h||a)&&(x.mouseleave=function(e){z._isResize||(h||a)&&z.handleTargetLeaveEvent(e)}),(E||S["header-cell-click"]||F||"cell"===N.trigger)&&(x.click=function(e){return z.triggerHeaderCellClickEvent(e,_)}),S["header-cell-dblclick"]&&(x.dblclick=function(e){return z.triggerHeaderCellDBLClickEvent(e,_)}),(X||F)&&(x.mousedown=function(e){return z.triggerHeaderCellMousedownEvent(e,_)});var b="seq"===t.type||"index"===t.type?"seq":t.type;return T("th",{class:["vxe-header--column",t.id,(l={},_defineProperty(l,"col--".concat(u),u),_defineProperty(l,"col--".concat(b),b),_defineProperty(l,"col--last",e===C.length-1),_defineProperty(l,"col--fixed",t.fixed),_defineProperty(l,"col--group",s),_defineProperty(l,"col--ellipsis",m),_defineProperty(l,"fixed--hidden",d),_defineProperty(l,"is--sortable",t.sortable),_defineProperty(l,"is--filter",!!t.filters),_defineProperty(l,"filter--active",y),_defineProperty(l,"col--current",O===t),l),_tools.UtilTools.getClass(n,_),_tools.UtilTools.getClass(W,_)],attrs:{"data-colid":t.id,colspan:1<t.colSpan?t.colSpan:null,rowspan:1<t.rowSpan?t.rowSpan:null},style:M?_xeUtils.default.isFunction(M)?M(_):M:null,on:x,key:R||s?t.id:e},[T("div",{class:["vxe-cell",{"c--title":p,"c--tooltip":h,"c--ellipsis":f}]},t.renderHeader(T,_)),!d&&!s&&(_xeUtils.default.isBoolean(t.resizable)?t.resizable:D)?T("div",{class:["vxe-resizable",{"is--line":!k||"none"===k}],on:{mousedown:function(e){return $.resizeMousedown(e,_)}}}):null])}).concat(d?[T("th",{class:"col--gutter"})]:[]))}))]),T("div",{class:"vxe-table--header-border-line",ref:"repair"})])},methods:{uploadColumn:function(){this.headerColumn=this.isGroup?(0,_util.convertToRows)(this.tableGroupColumn):[this.$parent.scrollXLoad&&this.fixedType?this.fixedColumn:this.tableColumn]},resizeMousedown:function(e,t){var l=t.column,o=this.$parent,r=this.$el,i=this.fixedType,n=o.$refs,a=n.tableBody,s=n.leftContainer,d=n.rightContainer,c=n.resizeBar,u=e.target,f=e.clientX,p=u.parentNode,h=0,m=a.$el,x=_tools.DomTools.getOffsetPos(u,r),y=u.clientWidth,g=Math.floor(y/2),v=l.getMinWidth()-g,_=x.left-p.clientWidth+y+v,b=x.left+g,C=document.onmousemove,w=document.onmouseup,T="left"===i,$="right"===i,z=0;if(T||$){for(var P=T?"nextElementSibling":"previousElementSibling",S=p[P];S&&!_tools.DomTools.hasClass(S,"fixed--hidden");)_tools.DomTools.hasClass(S,"col--group")||(z+=S.offsetWidth),S=S[P];$&&d&&(b=d.offsetLeft+z)}var D=function(e){e.stopPropagation(),e.preventDefault();var t=e.clientX-f,l=b+t,o=i?0:m.scrollLeft;T?l=Math.min(l,(d?d.offsetLeft:m.clientWidth)-z-v):$&&(_=(s?s.clientWidth:0)+z+v,l=Math.min(l,b+p.clientWidth-v)),h=Math.max(l,_),c.style.left="".concat(h-o,"px")};o._isResize=!0,_tools.DomTools.addClass(o.$el,"c--resize"),c.style.display="block",document.onmousemove=D,document.onmouseup=function(){document.onmousemove=C,document.onmouseup=w,l.resizeWidth=l.renderWidth+($?b-h:h-b),c.style.display="none",o._isResize=!1,o._lastResizeTime=Date.now(),o.analyColumnWidth(),o.recalculate(!0),_tools.DomTools.removeClass(o.$el,"c--resize"),o.saveCustomResizable(),o.emitEvent("resizable-change",t,e)},D(e)}}};exports.default=_default;