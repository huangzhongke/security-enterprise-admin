"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils/methods/xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_vXETable=_interopRequireDefault(require("../../v-x-e-table")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var l=Object.prototype.toString.call(e).slice(8,-1);return"Object"===l&&e.constructor&&(l=e.constructor.name),"Map"===l||"Set"===l?Array.from(e):"Arguments"===l||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var l=0,r=new Array(t);l<t;l++)r[l]=e[l];return r}function _defineProperty(e,t,l){return t in e?Object.defineProperty(e,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[t]=l,e}var scrollProcessTimeout,cellType="body";function isOperateMouse(e){return e._isResize||e.lastScrollTime&&Date.now()<e.lastScrollTime+e.delayHover}function countTreeExpand(e,t){var l=t.$table,r=e[l.treeOpts.children],o=1;if(l.isTreeExpandByRow(e))for(var n=0;n<r.length;n++)o+=countTreeExpand(r[n],t);return o}function getOffsetSize(e){switch(e.vSize){case"mini":return 3;case"small":return 2;case"medium":return 1}return 0}function calcTreeLine(e,t){var l=e.$table,r=e.$rowIndex,o=1;return r&&(o=countTreeExpand(t[r-1],e)),l.rowHeight*o-(r?1:12-getOffsetSize(l))}function renderLine(e,t,l,r,o,n){var i=n.column,s=l.treeOpts,a=l.treeConfig;return i.slots&&i.slots.line?i.slots.line.call(l,n,e):i.treeNode&&a&&s.line?[e("div",{class:"vxe-tree--line-wrapper"},[e("div",{class:"vxe-tree--line",style:{height:"".concat(calcTreeLine(n,o),"px"),left:"".concat(r*s.indent+(r?2-getOffsetSize(l):0)+16,"px")}})])]:[]}function renderBorder(e,t){return e("div",{class:"vxe-table-".concat(t,"ed-borders"),ref:"".concat(t,"Borders")},[e("span",{class:"vxe-table-border-top",ref:"".concat(t,"Top")}),e("span",{class:"vxe-table-border-right",ref:"".concat(t,"Right")}),e("span",{class:"vxe-table-border-bottom",ref:"".concat(t,"Bottom")}),e("span",{class:"vxe-table-border-left",ref:"".concat(t,"Left")})])}function renderColumn(e,t,l,r,o,n,i,s,a,c,d,u,p,f,y){var v,g,x=l._e,m=l.$listeners,h=l.tableData,b=l.height,w=l.columnKey,_=l.overflowX,T=l.scrollXLoad,S=l.scrollYLoad,C=l.highlightCurrentRow,O=l.showOverflow,$=l.align,k=l.currentColumn,L=l.cellClassName,R=l.cellStyle,E=l.spanMethod,I=l.radioOpts,A=l.checkboxOpts,B=l.expandOpts,P=l.treeOpts,U=l.tooltipOpts,q=l.mouseConfig,D=l.mouseOpts,M=l.editConfig,H=l.editOpts,j=l.editRules,N=l.validOpts,X=l.editStore,z=l.validStore,W=u.editRender,Y=u.align,F=u.showOverflow,K=u.className,G=u.treeNode,V=X.actived,J=U.enabled,Q=l.getColumnIndex(u),Z=l._getColumnIndex(u),ee=q&&D.selected,te=q&&(D.range||D.checked),le=i?u.fixed!==i:u.fixed&&_,re=_xeUtils.default.isUndefined(F)||_xeUtils.default.isNull(F)?O:F,oe="ellipsis"===re,ne="title"===re,ie=!0===re||"tooltip"===re,se=ne||ie||oe,ae={},ce=Y||$,de=z.row===a&&z.column===u,ue=j&&("default"===N.message?b||1<h.length:"inline"===N.message),pe={"data-colid":u.id},fe=m["cell-mouseenter"],ye=m["cell-mouseleave"],ve=W&&M&&"dblclick"===H.trigger,ge={$table:l,$seq:r,seq:o,rowid:n,row:a,rowIndex:c,$rowIndex:d,column:u,columnIndex:Q,$columnIndex:p,_columnIndex:Z,fixed:i,type:cellType,isHidden:le,level:s,data:h,items:y};if(!T&&!S||se||(oe=se=!0),(ne||ie||J||fe)&&(ae.mouseenter=function(e){isOperateMouse(l)||(ne?_tools.DomTools.updateCellTitle(e,u):(ie||J)&&l.triggerTooltipEvent(e,ge),fe&&l.emitEvent("cell-mouseenter",Object.assign({cell:e.currentTarget},ge),e))}),(ie||J||m["cell-bindMouseleave"])&&(ae.mouseleave=function(e){isOperateMouse(l)||((ie||J)&&l.handleTargetLeaveEvent(e),ye&&l.emitEvent("cell-mouseleave",Object.assign({cell:e.currentTarget},ge),e))}),(A.range||te||ee)&&(ae.mousedown=function(e){l.triggerCellMousedownEvent(e,ge)}),(C||m["cell-click"]||te||W&&M||"row"===B.trigger||"cell"===B.trigger||"row"===I.trigger||"radio"===u.type&&"cell"===I.trigger||"row"===A.trigger||("checkbox"===u.type||"selection"===u.type)&&"cell"===A.trigger||"row"===P.trigger||u.treeNode&&"cell"===P.trigger)&&(ae.click=function(e){l.triggerCellClickEvent(e,ge)}),(ve||m["cell-dblclick"])&&(ae.dblclick=function(e){l.triggerCellDBLClickEvent(e,ge)}),E){var xe=E(ge)||{},me=xe.rowspan,he=void 0===me?1:me,be=xe.colspan,we=void 0===be?1:be;if(!he||!we)return null;1<he&&(pe.rowspan=he),1<we&&(pe.colspan=we)}!le&&W&&M&&H.showStatus&&(g=l.isUpdateByRow(a,u.property));var _e="seq"===u.type||"index"===u.type?"seq":u.type;return e("td",{class:["vxe-body--column",u.id,(v={},_defineProperty(v,"col--".concat(ce),ce),_defineProperty(v,"col--".concat(_e),_e),_defineProperty(v,"col--last",p===f.length-1),_defineProperty(v,"col--tree-node",G),_defineProperty(v,"col--edit",!!W),_defineProperty(v,"col--ellipsis",se),_defineProperty(v,"fixed--hidden",le),_defineProperty(v,"col--dirty",g),_defineProperty(v,"col--actived",M&&W&&V.row===a&&(V.column===u||"row"===H.mode)),_defineProperty(v,"col--valid-error",de),_defineProperty(v,"col--current",k===u),v),_tools.UtilTools.getClass(K,ge),_tools.UtilTools.getClass(L,ge)],key:w?u.id:p,attrs:pe,style:R?_xeUtils.default.isFunction(R)?R(ge):R:null,on:ae},O&&le?[e("div",{class:["vxe-cell",{"c--title":ne,"c--tooltip":ie,"c--ellipsis":oe}]})]:renderLine(e,t,l,s,y,ge).concat([e("div",{class:["vxe-cell",{"c--title":ne,"c--tooltip":ie,"c--ellipsis":oe}],attrs:{title:ne?_tools.UtilTools.getCellLabel(a,u,ge):null}},u.renderCell(e,ge)),ue?de?e("div",{class:"vxe-cell--valid",style:z.rule&&z.rule.maxWidth?{width:"".concat(z.rule.maxWidth,"px")}:null},[e("span",{class:"vxe-cell--valid-msg"},z.content)]):x():null]))}function renderRows(f,y,v,g,x,m,h,b){var w=v.stripe,_=v.rowKey,T=v.highlightHoverRow,S=v.rowClassName,C=v.rowStyle,O=v.showOverflow,$=v.treeConfig,k=v.treeOpts,L=v.treeExpandeds,R=v.scrollYLoad,E=v.scrollYStore,I=v.editStore,A=v.rowExpandeds,B=v.radioOpts,P=v.checkboxOpts,U=v.expandColumn,q=[];return h.forEach(function(l,r){var e={},o=r,n=o+1;R&&(n+=E.startIndex),o=v.getRowIndex(l),T&&(e.mouseenter=function(e){isOperateMouse(v)||v.triggerHoverEvent(e,{row:l,rowIndex:o})},e.mouseleave=function(){isOperateMouse(v)||v.clearHoverRow()});var i=_tools.UtilTools.getRowid(v,l),t={$table:v,$seq:g,seq:n,rowid:i,fixed:m,type:cellType,rowLevel:x,row:l,rowIndex:o,$rowIndex:r};if(q.push(f("tr",{class:["vxe-body--row",{"row--stripe":w&&(v._getRowIndex(l)+1)%2==0,"is--new":-1<I.insertList.indexOf(l),"row--radio":B.highlight&&v.selectRow===l,"row--cheched":P.highlight&&v.isCheckedByCheckboxRow(l)},S?_xeUtils.default.isFunction(S)?S(t):S:""],attrs:{"data-rowid":i},style:C?_xeUtils.default.isFunction(C)?C(t):C:null,key:_||$?i:r,on:e},b.map(function(e,t){return renderColumn(f,y,v,g,n,i,m,x,l,o,r,e,t,b,h)}))),U&&A.length&&-1<A.indexOf(l)){var s,a=v.getColumnIndex(U);$&&(s={paddingLeft:"".concat(x*k.indent+30,"px")});var c=U.showOverflow,d=_xeUtils.default.isUndefined(c)||_xeUtils.default.isNull(c)?O:c,u={$table:v,$seq:g,seq:n,column:U,columnIndex:a,fixed:m,type:cellType,level:x,row:l,rowIndex:o,$rowIndex:r};q.push(f("tr",{class:"vxe-body--expanded-row",key:"expand_".concat(i),style:C?_xeUtils.default.isFunction(C)?C(u):C:null,on:e},[f("td",{class:["vxe-body--expanded-column",{"fixed--hidden":m,"col--ellipsis":d}],attrs:{colspan:b.length}},[f("div",{class:"vxe-body--expanded-cell",style:s},[U.renderData(f,u)])])]))}if($&&L.length){var p=l[k.children];p&&p.length&&-1<L.indexOf(l)&&q.push.apply(q,_toConsumableArray(renderRows(f,y,v,g?"".concat(g,".").concat(n):"".concat(n),x+1,m,p,b)))}}),q}function syncBodyScroll(e,t,l){(t||l)&&(t&&(t.onscroll=null,t.scrollTop=e),l&&(l.onscroll=null,l.scrollTop=e),clearTimeout(scrollProcessTimeout),scrollProcessTimeout=setTimeout(function(){t&&(t.onscroll=t._onscroll),l&&(l.onscroll=l._onscroll)},100))}var _default={name:"VxeTableBody",props:{tableData:Array,tableColumn:Array,visibleColumn:Array,fixedColumn:Array,size:String,fixedType:String,isGroup:Boolean},mounted:function(){var e=this.$parent,t=this.$el,l=this.$refs,r=this.fixedType,o=e.elemStore,n="".concat(r||"main","-body-");o["".concat(n,"wrapper")]=t,o["".concat(n,"table")]=l.table,o["".concat(n,"colgroup")]=l.colgroup,o["".concat(n,"list")]=l.tbody,o["".concat(n,"xSpace")]=l.xSpace,o["".concat(n,"ySpace")]=l.ySpace,o["".concat(n,"checkRange")]=l.checkRange,o["".concat(n,"emptyBlock")]=l.emptyBlock,this.$el.onscroll=this.scrollEvent,this.$el._onscroll=this.scrollEvent},beforeDestroy:function(){this.$el._onscroll=null,this.$el.onscroll=null},render:function(l){var e,t=this._e,r=this.$parent,o=this.fixedColumn,n=this.fixedType,i=r.$scopedSlots,s=r.tId,a=r.tableData,c=r.tableColumn,d=r.showOverflow,u=r.spanMethod,p=r.scrollXLoad,f=r.mouseConfig,y=r.mouseOpts,v=r.emptyRender,g=r.emptyOpts,x=r.keyboardConfig,m=void 0===x?{}:x,h=f&&(y.range||y.checked);if(u||(n&&d?c=o:p&&n&&(c=o)),i.empty)e=i.empty.call(this,{$table:this},l);else{var b=v?_vXETable.default.renderer.get(g.name):null;e=b&&b.renderEmpty?b.renderEmpty.call(this,l,g,{$table:this},{$table:this}):_conf.default.i18n("vxe.table.emptyText")}return l("div",{class:["vxe-table--body-wrapper",n?"fixed-".concat(n,"--wrapper"):"body--wrapper"],attrs:{"data-tid":s}},[n?t():l("div",{class:"vxe-body--x-space",ref:"xSpace"}),l("div",{class:"vxe-body--y-space",ref:"ySpace"}),l("table",{class:"vxe-table--body",attrs:{"data-tid":s,cellspacing:0,cellpadding:0,border:0},ref:"table"},[l("colgroup",{ref:"colgroup"},c.map(function(e,t){return l("col",{attrs:{name:e.id},key:t})})),l("tbody",{ref:"tbody"},renderRows(l,this,r,"",0,n,a,c))]),n||!h&&!m.isCut?null:l("div",{class:"vxe-table--borders"},[h?renderBorder(l,"check"):null,m.isCut?renderBorder(l,"copy"):null]),l("div",{ref:"checkRange",class:"vxe-table--checkbox-range"}),n?null:l("div",{class:"vxe-table--empty-block",ref:"emptyBlock"},[l("div",{class:"vxe-table--empty-content"},e)])])},methods:{scrollEvent:function(e){var t=this.$parent,l=this.fixedType,r=t.$refs,o=t.highlightHoverRow,n=t.scrollXLoad,i=t.scrollYLoad,s=t.lastScrollTop,a=t.lastScrollLeft,c=r.tableHeader,d=r.tableBody,u=r.leftBody,p=r.rightBody,f=r.tableFooter,y=r.validTip,v=c?c.$el:null,g=f?f.$el:null,x=d.$el,m=u?u.$el:null,h=p?p.$el:null,b=x.scrollTop,w=x.scrollLeft,_=w!==a,T=b!==s;t.lastScrollTop=b,t.lastScrollLeft=w,t.lastScrollTime=Date.now(),o&&t.clearHoverRow(),m&&"left"===l?syncBodyScroll(b=m.scrollTop,x,h):h&&"right"===l?syncBodyScroll(b=h.scrollTop,x,m):(_&&(v&&(v.scrollLeft=x.scrollLeft),g&&(g.scrollLeft=x.scrollLeft)),(m||h)&&(t.checkScrolling(),T&&syncBodyScroll(b,m,h))),n&&_&&(t.triggerScrollXEvent(e),v&&w+x.clientWidth>=x.scrollWidth-80&&this.$nextTick(function(){x.scrollLeft!==v.scrollLeft&&(v.scrollLeft=x.scrollLeft)})),i&&T&&t.triggerScrollYEvent(e),_&&y&&y.visible&&y.updatePlacement(),t.emitEvent("scroll",{type:cellType,fixed:l,scrollTop:b,scrollLeft:w,isX:_,isY:T},e)}}};exports.default=_default;