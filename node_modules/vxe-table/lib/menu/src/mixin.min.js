"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils/methods/xe-utils")),_tools=require("../../tools"),_vXETable=_interopRequireDefault(require("../../v-x-e-table"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default={methods:{_closeMenu:function(){return Object.assign(this.ctxMenuStore,{visible:!1,selected:null,childPos:null,selectChild:null,showChild:!1}),this.$nextTick()},moveCtxMenu:function(e,t,l,i,n,o,s){var r,u=_xeUtils.default.findIndexOf(s,function(e){return l[i]===e});if(t===n)o&&_tools.UtilTools.hasChildrenList(l.selected)?l.showChild=!0:(l.showChild=!1,l.selectChild=null);else if(38===t){for(var c=u-1;0<=c;c--)if(!1!==s[c].visible){r=s[c];break}l[i]=r||s[s.length-1]}else if(40===t){for(var a=u+1;a<s.length;a++)if(!1!==s[a].visible){r=s[a];break}l[i]=r||s[0]}else!l[i]||13!==t&&32!==t||this.ctxMenuLinkEvent(e,l[i])},handleGlobalContextmenuEvent:function(e){var t=this.$refs,l=this.tId,i=this.contextMenu,n=this.ctxMenuStore,o=this.ctxMenuOpts,s=["header","body","footer"];if(i){if(n.visible&&n.visible&&t.ctxWrapper&&_tools.DomTools.getEventTargetNode(e,t.ctxWrapper.$el).flag)return void e.preventDefault();for(var r=0;r<s.length;r++){var u=s[r],c=_tools.DomTools.getEventTargetNode(e,this.$el,"vxe-".concat(u,"--column"),function(e){return e.parentNode.parentNode.parentNode.getAttribute("data-tid")===l}),a={type:u,$grid:this.$xegrid,$table:this,columns:this.visibleColumn.slice(0),$event:e};if(c.flag){var d=c.targetElem,h=this.getColumnNode(d).item,f="".concat(u,"-");if(Object.assign(a,{column:h,columnIndex:this.getColumnIndex(h),cell:d}),"body"===u){var v=this.getRowNode(d.parentNode).item;f="",a.row=v,a.rowIndex=this.getRowIndex(v)}return this.openContextMenu(e,u,a),void this.emitEvent("".concat(f,"cell-context-menu"),a,e)}if(_tools.DomTools.getEventTargetNode(e,this.$el,"vxe-table--".concat(u,"-wrapper"),function(e){return e.getAttribute("data-tid")===l}).flag)return void("cell"===o.trigger?e.preventDefault():this.openContextMenu(e,u,a))}}t.filterWrapper&&!_tools.DomTools.getEventTargetNode(e,t.filterWrapper.$el).flag&&this.closeFilter(),this.closeMenu()},openContextMenu:function(d,e,t){var h=this,f=this.ctxMenuStore,l=this.ctxMenuOpts,i=l[e],n=l.visibleMethod;if(i){var v=i.options;i.disabled?d.preventDefault():v&&v.length&&(t.options=v,this.preventEvent(d,"event.showMenu",t,null,function(){if(!n||n(t,d)){d.preventDefault(),h.updateZindex();var e=_tools.DomTools.getDomNode(),o=e.scrollTop,s=e.scrollLeft,r=e.visibleHeight,u=e.visibleWidth,c=d.clientY+o,a=d.clientX+s;Object.assign(f,{args:t,visible:!0,list:v,selected:null,selectChild:null,showChild:!1,childPos:null,style:{zIndex:h.tZindex,top:"".concat(c,"px"),left:"".concat(a,"px")}}),h.$nextTick(function(){var e=h.$refs.ctxWrapper.$el,t=e.clientHeight,l=e.clientWidth,i=d.clientY+t-r,n=d.clientX+l-u;-10<i&&(f.style.top="".concat(Math.max(o+2,c-t-2),"px")),-10<n&&(f.style.left="".concat(Math.max(s+2,a-l-2),"px")),-220<n&&(f.childPos="left")})}else h.closeMenu()}))}this.closeFilter()},ctxMenuMouseoverEvent:function(e,t,l){var i=this.ctxMenuStore;e.preventDefault(),e.stopPropagation(),i.selected=t,(i.selectChild=l)||(i.showChild=_tools.UtilTools.hasChildrenList(t))},ctxMenuMouseoutEvent:function(e,t){var l=this.ctxMenuStore;t.children||(l.selected=null),l.selectChild=null},ctxMenuLinkEvent:function(e,t){if(!(t.disabled||t.children&&t.children.length)){var l=_vXETable.default.menus.get(t.code),i=Object.assign({menu:t,$grid:this.$xegrid,$table:this,$event:e},this.ctxMenuStore.args);l&&l.call(this,i,e),this.emitEvent("context-menu-click",i,e),this.closeMenu()}}}};exports.default=_default;