"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _conf=_interopRequireDefault(require("../../conf")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _default2={name:"VxePulldown",props:{disabled:Boolean,placement:String,size:{type:String,default:function(){return _conf.default.size}},transfer:Boolean},data:function(){return{panelIndex:0,panelStyle:null,panelPlacement:null,currentValue:null,visiblePanel:!1,animatVisible:!1,isActivated:!1}},computed:{vSize:function(){return this.size||this.$parent.size||this.$parent.vSize}},created:function(){_tools.GlobalEvent.on(this,"mousewheel",this.handleGlobalMousewheelEvent),_tools.GlobalEvent.on(this,"mousedown",this.handleGlobalMousedownEvent),_tools.GlobalEvent.on(this,"blur",this.handleGlobalBlurEvent)},mounted:function(){this.transfer&&document.body.appendChild(this.$refs.panel)},beforeDestroy:function(){var e=this.$refs.panel;e&&e.parentNode&&e.parentNode.removeChild(e)},destroyed:function(){_tools.GlobalEvent.off(this,"mousewheel"),_tools.GlobalEvent.off(this,"mousedown"),_tools.GlobalEvent.off(this,"blur")},render:function(e){var t,n,i=this.$slots,o=this.vSize,l=this.transfer,s=this.isActivated,a=this.disabled,r=this.animatVisible,d=this.visiblePanel,u=this.panelStyle,h=this.panelPlacement;return e("div",{class:["vxe-pulldown",(t={},_defineProperty(t,"size--".concat(o),o),_defineProperty(t,"is--visivle",d),_defineProperty(t,"is--disabled",a),_defineProperty(t,"is--active",s),t)]},[e("div",{ref:"content",class:"vxe-pulldown--content"},i.default),e("div",{ref:"panel",class:["vxe-table--ignore-clear vxe-pulldown--panel",(n={},_defineProperty(n,"size--".concat(o),o),_defineProperty(n,"is--transfer",l),_defineProperty(n,"animat--leave",r),_defineProperty(n,"animat--enter",d),n)],attrs:{"data-placement":h},style:u},i.dropdown)])},methods:{handleGlobalMousewheelEvent:function(e){var t=this.$refs,n=this.$el,i=this.disabled,o=this.visiblePanel;if(!i&&o){var l=_tools.DomTools.getEventTargetNode(e,n).flag;l||_tools.DomTools.getEventTargetNode(e,t.panel).flag?l&&this.updatePlacement():(this.hidePanel(),this.$emit("hide-panel",{$event:e}))}},handleGlobalMousedownEvent:function(e){var t=this.$refs,n=this.$el,i=this.disabled,o=this.visiblePanel;i||(this.isActivated=_tools.DomTools.getEventTargetNode(e,n).flag||_tools.DomTools.getEventTargetNode(e,t.panel).flag,o&&!this.isActivated&&(this.hidePanel(),this.$emit("hide-panel",{$event:e})))},handleGlobalBlurEvent:function(e){this.visiblePanel&&(this.hidePanel(),this.$emit("hide-panel",{$event:e}))},updateZindex:function(){this.panelIndex<_tools.UtilTools.getLastZIndex()&&(this.panelIndex=_tools.UtilTools.nextZIndex())},isPanelVisible:function(){return this.visiblePanel},togglePanel:function(){return this.visiblePanel?this.hidePanel():this.showPanel()},showPanel:function(){var t=this;return new Promise(function(e){t.disabled?e(t.$nextTick()):(clearTimeout(t.hidePanelTimeout),t.isActivated=!0,t.animatVisible=!0,setTimeout(function(){t.visiblePanel=!0,e(t.$nextTick())},10),t.updateZindex(),t.updatePlacement())})},hidePanel:function(){var t=this;return this.visiblePanel=!1,new Promise(function(e){t.hidePanelTimeout=setTimeout(function(){t.animatVisible=!1,e(t.$nextTick())},350)})},updatePlacement:function(){var _=this;return this.$nextTick().then(function(){var e=_.$refs,t=_.transfer,n=_.placement,i=_.panelIndex,o=e.content,l=e.panel,s=o.offsetHeight,a=o.offsetWidth,r=l.offsetHeight,d=l.offsetWidth,u={zIndex:i},h=_tools.DomTools.getAbsolutePos(o),f=h.boundingTop,c=h.boundingLeft,p=h.visibleHeight,v=h.visibleWidth,b="bottom";if(t){var m=c,P=f+s;"top"===n?(b="top",P=f-r):(p<P+r+5&&(b="top",P=f-r),P<5&&(b="bottom",P=f+s)),v<m+d+5&&(m-=m+d+5-v),m<5&&(m=5),Object.assign(u,{left:"".concat(m,"px"),top:"".concat(P,"px"),minWidth:"".concat(a,"px")})}else"top"===n?(b="top",u.bottom="".concat(s,"px")):p<f+s+r&&(b="top",u.bottom="".concat(s,"px"));return _.panelStyle=u,_.panelPlacement=b,_.$nextTick()})}}};exports.default=_default2;