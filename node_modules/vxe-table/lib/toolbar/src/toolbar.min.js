"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils/methods/xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_vXETable=_interopRequireDefault(require("../../v-x-e-table")),_tools=require("../../tools");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _defineProperty(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}function renderBtns(h,f){var d=f._e,t=f.$scopedSlots,v=f.$xegrid,p=f.$xetable,e=f.buttons,o=void 0===e?[]:e;return t.buttons?t.buttons.call(f,{$grid:v,$table:p},h):o.map(function(e){var t=e.name,o=e.visible,i=e.icon,n=e.type,s=e.status,l=e.disabled,r=e.loading,c=e.dropdowns,a=e.buttonRender,u=a?_vXETable.default.renderer.get(a.name):null;return!1===o?d():u&&u.renderButton?h("span",{class:"vxe-button--item"},u.renderButton.call(f,h,a,{$grid:v,$table:p,button:e},{$grid:v,$table:p})):h("vxe-button",{on:{click:function(t){return f.btnEvent(t,e)}},props:{icon:i,type:n,status:s,disabled:l,loading:r},scopedSlots:c&&c.length?{default:function(){return _tools.UtilTools.getFuncText(t)},dropdowns:function(){return c.map(function(e){return!1===e.visible?d():h("vxe-button",{on:{click:function(t){return f.btnEvent(t,e)}},props:{icon:e.icon,type:e.type,disabled:e.disabled,loading:e.loading}},_tools.UtilTools.getFuncText(e.name))})}}:null},_tools.UtilTools.getFuncText(t))})}function renderRightTools(t,e){var o=e.$scopedSlots,i=e.$xegrid,n=e.$xetable;return o.tools?o.tools.call(e,{$grid:i,$table:n},t):[]}function renderCustoms(s,l){var t=l.$xetable,e=l.customStore,o=l.customOpts,i=l.collectColumn,r=[],n={},c={},a=(t&&t.customOpts?t.customOpts.checkMethod:null)||o.checkMethod;return"manual"===o.trigger||("hover"===o.trigger?(n.mouseenter=l.handleMouseenterSettingEvent,n.mouseleave=l.handleMouseleaveSettingEvent,c.mouseenter=l.handleWrapperMouseenterEvent,c.mouseleave=l.handleWrapperMouseleaveEvent):n.click=l.handleClickSettingEvent),_xeUtils.default.eachTree(i,function(t){var e=_tools.UtilTools.formatText(t.getTitle(),1),o=t.getKey(),i=t.children&&t.children.length,n=!!a&&!a({column:t});(i||o)&&r.push(s("li",{class:["vxe-custom--option","level--".concat(t.level),{"is--group":i,"is--checked":t.visible,"is--indeterminate":t.halfVisible,"is--disabled":n}],attrs:{title:e},on:{click:function(){n||l.changeCustomOption(t)}}},[s("span",{class:"vxe-checkbox--icon vxe-checkbox--checked-icon"}),s("span",{class:"vxe-checkbox--icon vxe-checkbox--unchecked-icon"}),s("span",{class:"vxe-checkbox--icon vxe-checkbox--indeterminate-icon"}),s("span",{class:"vxe-checkbox--label"},e)]))}),s("div",{class:["vxe-custom--wrapper",{"is--active":e.visible}],ref:"customWrapper"},[s("vxe-button",{props:{circle:!0,icon:o.icon||_conf.default.icon.TOOLBAR_TOOLS_CUSTOM},attrs:{title:_conf.default.i18n("vxe.toolbar.custom")},on:n}),s("div",{class:"vxe-custom--option-wrapper"},[s("ul",{class:"vxe-custom--header"},[s("li",{class:["vxe-custom--option",{"is--checked":e.isAll,"is--indeterminate":e.isIndeterminate}],attrs:{title:_conf.default.i18n("vxe.table.allTitle")},on:{click:l.allCustomEvent}},[s("span",{class:"vxe-checkbox--icon vxe-checkbox--checked-icon"}),s("span",{class:"vxe-checkbox--icon vxe-checkbox--unchecked-icon"}),s("span",{class:"vxe-checkbox--icon vxe-checkbox--indeterminate-icon"}),s("span",{class:"vxe-checkbox--label"},_conf.default.i18n("vxe.toolbar.customAll"))])]),s("ul",{class:"vxe-custom--body",on:c},r),!1===o.isFooter?null:s("div",{class:"vxe-custom--footer"},[s("button",{class:"btn--confirm",on:{click:l.confirmCustomEvent}},_conf.default.i18n("vxe.toolbar.customConfirm")),s("button",{class:"btn--reset",on:{click:l.resetCustomEvent}},_conf.default.i18n("vxe.toolbar.customRestore"))])])])}var _default2={name:"VxeToolbar",props:{id:String,loading:Boolean,resizable:[Boolean,Object],refresh:[Boolean,Object],import:[Boolean,Object],export:[Boolean,Object],print:[Boolean,Object],zoom:[Boolean,Object],setting:[Boolean,Object],custom:[Boolean,Object],buttons:{type:Array,default:function(){return _conf.default.toolbar.buttons}},perfect:{type:Boolean,default:function(){return _conf.default.toolbar.perfect}},size:{type:String,default:function(){return _conf.default.toolbar.size||_conf.default.size}}},inject:{$xegrid:{default:null}},data:function(){return{$xetable:null,isRefresh:!1,collectColumn:[],customStore:{isAll:!1,isIndeterminate:!1,visible:!1}}},computed:{vSize:function(){return this.size||this.$parent.size||this.$parent.vSize},refreshOpts:function(){return Object.assign({},_conf.default.toolbar.refresh,this.refresh)},importOpts:function(){return Object.assign({},_conf.default.toolbar.import,this.import)},exportOpts:function(){return Object.assign({},_conf.default.toolbar.export,this.export)},printOpts:function(){return Object.assign({},_conf.default.toolbar.print,this.print)},resizableOpts:function(){return Object.assign({},_conf.default.toolbar.resizable,this.resizable)},zoomOpts:function(){return Object.assign({},_conf.default.toolbar.zoom,this.zoom)},customOpts:function(){return Object.assign({},_conf.default.toolbar.custom,this.custom)}},created:function(){var e=this,t=this.customOpts,o=this.refresh,i=this.resizable,n=this.setting,s=this.id,l=this.refreshOpts;if(t.storage&&!s)return _tools.UtilTools.error("vxe.error.reqProp",["toolbar.id"]);s&&_tools.UtilTools.warn("vxe.error.removeProp",["toolbar.id"]),n&&_tools.UtilTools.warn("vxe.error.delProp",["toolbar.setting","toolbar.custom"]),_vXETable.default._export||!this.export&&!this.import||_tools.UtilTools.error("vxe.error.reqModule",["Export"]),i&&_tools.UtilTools.warn("vxe.error.delProp",["toolbar.resizable","custom-config.storage"]),t.storage&&_tools.UtilTools.warn("vxe.error.delProp",["toolbar.custom.storage","custom-config.storage"]),this.$nextTick(function(){var t=e.fintTable();!o||e.$xegrid||l.query||_tools.UtilTools.warn("vxe.error.notFunc",["query"]),t&&t.connect(e)}),_tools.GlobalEvent.on(this,"mousedown",this.handleGlobalMousedownEvent),_tools.GlobalEvent.on(this,"blur",this.handleGlobalBlurEvent)},destroyed:function(){_tools.GlobalEvent.off(this,"mousedown"),_tools.GlobalEvent.off(this,"blur")},render:function(t){var e,o=this.$xegrid,i=this.perfect,n=this.loading,s=this.importOpts,l=this.exportOpts,r=this.refresh,c=this.refreshOpts,a=this.zoom,u=this.zoomOpts,h=this.custom,f=this.setting,d=this.vSize;return t("div",{class:["vxe-toolbar",(e={},_defineProperty(e,"size--".concat(d),d),_defineProperty(e,"is--perfect",i),_defineProperty(e,"is--loading",n),e)]},[t("div",{class:"vxe-button--wrapper"},renderBtns(t,this)),t("div",{class:"vxe-tools--wrapper"},renderRightTools(t,this)),t("div",{class:"vxe-tools--operate"},[this.import?t("vxe-button",{props:{circle:!0,icon:s.icon||_conf.default.icon.TOOLBAR_TOOLS_IMPORT},attrs:{title:_conf.default.i18n("vxe.toolbar.import")},on:{click:this.importEvent}}):null,this.export?t("vxe-button",{props:{circle:!0,icon:l.icon||_conf.default.icon.TOOLBAR_TOOLS_EXPORT},attrs:{title:_conf.default.i18n("vxe.toolbar.export")},on:{click:this.exportEvent}}):null,this.print?t("vxe-button",{props:{circle:!0,icon:this.printOpts.icon||_conf.default.icon.TOOLBAR_TOOLS_PRINT},attrs:{title:_conf.default.i18n("vxe.toolbar.print")},on:{click:this.printEvent}}):null,r?t("vxe-button",{props:{circle:!0,icon:this.isRefresh?c.iconLoading||_conf.default.icon.TOOLBAR_TOOLS_REFRESH_LOADING:c.icon||_conf.default.icon.TOOLBAR_TOOLS_REFRESH},attrs:{title:_conf.default.i18n("vxe.toolbar.refresh")},on:{click:this.refreshEvent}}):null,a&&o?t("vxe-button",{props:{circle:!0,icon:o.isMaximized()?u.iconOut||_conf.default.icon.TOOLBAR_TOOLS_ZOOM_OUT:u.iconIn||_conf.default.icon.TOOLBAR_TOOLS_ZOOM_IN},attrs:{title:_conf.default.i18n("vxe.toolbar.zoom".concat(o.isMaximized()?"Out":"In"))},on:{click:o.triggerZoomEvent}}):null,h||f?renderCustoms(t,this):null])])},methods:{syncUpdate:function(t){var e=t.collectColumn,o=t.$table;this.$xetable=o,this.collectColumn=e},fintTable:function(){var t=this.$parent.$children,o=t.indexOf(this);return _xeUtils.default.find(t,function(t,e){return t&&t.refreshColumn&&o<e&&"vxe-table"===t.$vnode.componentOptions.tag})},checkTable:function(){if(this.$xetable)return!0;_tools.UtilTools.error("vxe.error.barUnableLink")},showCustom:function(){this.customStore.visible=!0,this.checkCustomStatus()},closeCustom:function(){var t=this.custom,e=this.setting,o=this.customStore;o.visible&&(o.visible=!1,!t&&!e||o.immediate||this.handleCustoms())},confirmCustomEvent:function(t){this.closeCustom(),this.emitCustomEvent("confirm",t)},customOpenEvent:function(t){var e=this.customStore;this.checkTable()&&(e.visible||(this.showCustom(),this.emitCustomEvent("open",t)))},customColseEvent:function(t){this.customStore.visible&&(this.closeCustom(),this.emitCustomEvent("close",t))},resetCustomEvent:function(t){var e=this.$xetable,o=this.collectColumn,i=this.customOpts,n=e.customOpts.checkMethod||i.checkMethod;_xeUtils.default.eachTree(o,function(t){n&&!n({column:t})||(t.visible=t.defaultVisible,t.halfVisible=!1),t.resizeWidth=0}),e.saveCustomResizable(!0),this.closeCustom(),this.emitCustomEvent("reset",t)},emitCustomEvent:function(t,e){var o=this.$xetable,i=this.$xegrid;(i||o).$emit("custom",{type:t,$table:o,$grid:i,$event:e},e)},changeCustomOption:function(t){var e=!t.visible;_xeUtils.default.eachTree([t],function(t){t.visible=e,t.halfVisible=!1}),this.handleOptionCheck(t),this.custom&&this.customOpts.immediate&&this.handleCustoms(),this.checkCustomStatus()},handleOptionCheck:function(e){var t=_xeUtils.default.findTree(this.collectColumn,function(t){return t===e});if(t&&t.parent){var o=t.parent;o.children&&o.children.length&&(o.visible=o.children.every(function(t){return t.visible}),o.halfVisible=!o.visible&&o.children.some(function(t){return t.visible||t.halfVisible}),this.handleOptionCheck(o))}},handleCustoms:function(){var t=this.$xetable;t.saveCustomVisible(),t.analyColumnWidth(),t.refreshColumn()},checkCustomStatus:function(){var t=this.$xetable,e=this.collectColumn,o=this.customOpts,i=t.customOpts.checkMethod||o.checkMethod;this.customStore.isAll=e.every(function(t){return!!i&&!i({column:t})||t.visible}),this.customStore.isIndeterminate=!this.customStore.isAll&&e.some(function(t){return(!i||i({column:t}))&&(t.visible||t.halfVisible)})},allCustomEvent:function(){var t=this.$xetable,e=this.collectColumn,o=this.customOpts,i=this.customStore,n=t.customOpts.checkMethod||o.checkMethod,s=!i.isAll;_xeUtils.default.eachTree(e,function(t){n&&!n({column:t})||(t.visible=s,t.halfVisible=!1)}),i.isAll=s,this.checkCustomStatus()},handleGlobalMousedownEvent:function(t){_tools.DomTools.getEventTargetNode(t,this.$refs.customWrapper).flag||this.customColseEvent(t)},handleGlobalBlurEvent:function(t){this.customColseEvent(t)},handleClickSettingEvent:function(t){this.customStore.visible?this.customColseEvent(t):this.customOpenEvent(t)},handleMouseenterSettingEvent:function(t){this.customStore.activeBtn=!0,this.customOpenEvent(t)},handleMouseleaveSettingEvent:function(t){var e=this,o=this.customStore;o.activeBtn=!1,setTimeout(function(){o.activeBtn||o.activeWrapper||e.customColseEvent(t)},300)},handleWrapperMouseenterEvent:function(t){this.customStore.activeWrapper=!0,this.customOpenEvent(t)},handleWrapperMouseleaveEvent:function(t){var e=this,o=this.customStore;o.activeWrapper=!1,setTimeout(function(){o.activeBtn||o.activeWrapper||e.customColseEvent(t)},300)},refreshEvent:function(){var t=this,e=this.$xegrid,o=this.refreshOpts;if(!this.isRefresh)if(o.query){this.isRefresh=!0;try{Promise.resolve(o.query()).catch(function(t){return t}).then(function(){t.isRefresh=!1})}catch(t){this.isRefresh=!1}}else e&&(this.isRefresh=!0,e.commitProxy("reload").catch(function(t){return t}).then(function(){t.isRefresh=!1}))},btnEvent:function(t,e){var o=this.$xegrid,i=this.$xetable,n=e.code;if(n)if(o)o.triggerToolbarBtnEvent(e,t);else{var s=_vXETable.default.commands.get(n),l={code:n,button:e,$xegrid:o,$table:i,$event:t};s&&s.call(this,l,t),this.$emit("button-click",l,t)}},importEvent:function(){this.checkTable()&&this.$xetable.openImport(this.importOpts)},exportEvent:function(){this.checkTable()&&this.$xetable.openExport(this.exportOpts)},printEvent:function(){this.checkTable()&&this.$xetable.print(this.printOpts)}}};exports.default=_default2;