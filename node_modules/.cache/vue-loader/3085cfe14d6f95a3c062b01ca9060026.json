{"remainingRequest":"D:\\codeSpace\\security-enterprise-FrontBackSplit_2.7.0\\security-enterprise-2.7.0\\security-enterprise-admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\codeSpace\\security-enterprise-FrontBackSplit_2.7.0\\security-enterprise-2.7.0\\security-enterprise-admin\\src\\views\\modules\\message\\mail-template-add-or-update.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\codeSpace\\security-enterprise-FrontBackSplit_2.7.0\\security-enterprise-2.7.0\\security-enterprise-admin\\src\\views\\modules\\message\\mail-template-add-or-update.vue","mtime":1595727761911},{"path":"D:\\codeSpace\\security-enterprise-FrontBackSplit_2.7.0\\security-enterprise-2.7.0\\security-enterprise-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\codeSpace\\security-enterprise-FrontBackSplit_2.7.0\\security-enterprise-2.7.0\\security-enterprise-admin\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\codeSpace\\security-enterprise-FrontBackSplit_2.7.0\\security-enterprise-2.7.0\\security-enterprise-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\codeSpace\\security-enterprise-FrontBackSplit_2.7.0\\security-enterprise-2.7.0\\security-enterprise-admin\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBDb29raWVzIGZyb20gJ2pzLWNvb2tpZScKaW1wb3J0IGRlYm91bmNlIGZyb20gJ2xvZGFzaC9kZWJvdW5jZScKaW1wb3J0ICdxdWlsbC9kaXN0L3F1aWxsLnNub3cuY3NzJwppbXBvcnQgUXVpbGwgZnJvbSAncXVpbGwnCmV4cG9ydCBkZWZhdWx0IHsKICBkYXRhICgpIHsKICAgIHJldHVybiB7CiAgICAgIHZpc2libGU6IGZhbHNlLAogICAgICBxdWlsbEVkaXRvcjogbnVsbCwKICAgICAgcXVpbGxFZGl0b3JUb29sYmFyT3B0aW9uczogWwogICAgICAgIFsnYm9sZCcsICdpdGFsaWMnLCAndW5kZXJsaW5lJywgJ3N0cmlrZSddLAogICAgICAgIFsnYmxvY2txdW90ZScsICdjb2RlLWJsb2NrJywgJ2ltYWdlJ10sCiAgICAgICAgW3sgJ2hlYWRlcic6IDEgfSwgeyAnaGVhZGVyJzogMiB9XSwKICAgICAgICBbeyAnbGlzdCc6ICdvcmRlcmVkJyB9LCB7ICdsaXN0JzogJ2J1bGxldCcgfV0sCiAgICAgICAgW3sgJ3NjcmlwdCc6ICdzdWInIH0sIHsgJ3NjcmlwdCc6ICdzdXBlcicgfV0sCiAgICAgICAgW3sgJ2luZGVudCc6ICctMScgfSwgeyAnaW5kZW50JzogJysxJyB9XSwKICAgICAgICBbeyAnZGlyZWN0aW9uJzogJ3J0bCcgfV0sCiAgICAgICAgW3sgJ3NpemUnOiBbJ3NtYWxsJywgZmFsc2UsICdsYXJnZScsICdodWdlJ10gfV0sCiAgICAgICAgW3sgJ2hlYWRlcic6IFsxLCAyLCAzLCA0LCA1LCA2LCBmYWxzZV0gfV0sCiAgICAgICAgW3sgJ2NvbG9yJzogW10gfSwgeyAnYmFja2dyb3VuZCc6IFtdIH1dLAogICAgICAgIFt7ICdmb250JzogW10gfV0sCiAgICAgICAgW3sgJ2FsaWduJzogW10gfV0sCiAgICAgICAgWydjbGVhbiddCiAgICAgIF0sCiAgICAgIHVwbG9hZFVybDogJycsCiAgICAgIGRhdGFGb3JtOiB7CiAgICAgICAgaWQ6ICcnLAogICAgICAgIG5hbWU6ICcnLAogICAgICAgIHN1YmplY3Q6ICcnLAogICAgICAgIGNvbnRlbnQ6ICcnCiAgICAgIH0KICAgIH0KICB9LAogIGNvbXB1dGVkOiB7CiAgICBkYXRhUnVsZSAoKSB7CiAgICAgIHZhciB2YWxpZGF0ZUNvbnRlbnQgPSAocnVsZSwgdmFsdWUsIGNhbGxiYWNrKSA9PiB7CiAgICAgICAgaWYgKHRoaXMucXVpbGxFZGl0b3IuZ2V0TGVuZ3RoKCkgPD0gMSkgewogICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG5ldyBFcnJvcih0aGlzLiR0KCd2YWxpZGF0ZS5yZXF1aXJlZCcpKSkKICAgICAgICB9CiAgICAgICAgY2FsbGJhY2soKQogICAgICB9CiAgICAgIHJldHVybiB7CiAgICAgICAgbmFtZTogWwogICAgICAgICAgeyByZXF1aXJlZDogdHJ1ZSwgbWVzc2FnZTogdGhpcy4kdCgndmFsaWRhdGUucmVxdWlyZWQnKSwgdHJpZ2dlcjogJ2JsdXInIH0KICAgICAgICBdLAogICAgICAgIHN1YmplY3Q6IFsKICAgICAgICAgIHsgcmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6IHRoaXMuJHQoJ3ZhbGlkYXRlLnJlcXVpcmVkJyksIHRyaWdnZXI6ICdibHVyJyB9CiAgICAgICAgXSwKICAgICAgICBjb250ZW50OiBbCiAgICAgICAgICB7IHJlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiB0aGlzLiR0KCd2YWxpZGF0ZS5yZXF1aXJlZCcpLCB0cmlnZ2VyOiAnYmx1cicgfSwKICAgICAgICAgIHsgdmFsaWRhdG9yOiB2YWxpZGF0ZUNvbnRlbnQsIHRyaWdnZXI6ICdibHVyJyB9CiAgICAgICAgXQogICAgICB9CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBpbml0ICgpIHsKICAgICAgdGhpcy52aXNpYmxlID0gdHJ1ZQogICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgICAgaWYgKHRoaXMucXVpbGxFZGl0b3IpIHsKICAgICAgICAgIHRoaXMucXVpbGxFZGl0b3IuZGVsZXRlVGV4dCgwLCB0aGlzLnF1aWxsRWRpdG9yLmdldExlbmd0aCgpKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnF1aWxsRWRpdG9ySGFuZGxlKCkKICAgICAgICB9CiAgICAgICAgdGhpcy4kcmVmc1snZGF0YUZvcm0nXS5yZXNldEZpZWxkcygpCiAgICAgICAgaWYgKHRoaXMuZGF0YUZvcm0uaWQpIHsKICAgICAgICAgIHRoaXMuZ2V0SW5mbygpCiAgICAgICAgfQogICAgICB9KQogICAgfSwKICAgIC8vIOWvjOaWh+acrOe8lui+keWZqAogICAgcXVpbGxFZGl0b3JIYW5kbGUgKCkgewogICAgICB0aGlzLnF1aWxsRWRpdG9yID0gbmV3IFF1aWxsKCcjSl9xdWlsbEVkaXRvcicsIHsKICAgICAgICBtb2R1bGVzOiB7CiAgICAgICAgICB0b29sYmFyOiB0aGlzLnF1aWxsRWRpdG9yVG9vbGJhck9wdGlvbnMKICAgICAgICB9LAogICAgICAgIHRoZW1lOiAnc25vdycKICAgICAgfSkKICAgICAgLy8g6Ieq5a6a5LmJ5LiK5Lyg5Zu+54mH5Yqf6IO9ICjkvb/nlKhlbGVtZW50IHVwbG9hZOe7hOS7tikKICAgICAgdGhpcy51cGxvYWRVcmwgPSBgJHt3aW5kb3cuU0lURV9DT05GSUdbJ2FwaVVSTCddfS9zeXMvb3NzL3VwbG9hZD90b2tlbj0ke0Nvb2tpZXMuZ2V0KCd0b2tlbicpfWAKICAgICAgdGhpcy5xdWlsbEVkaXRvci5nZXRNb2R1bGUoJ3Rvb2xiYXInKS5hZGRIYW5kbGVyKCdpbWFnZScsICgpID0+IHsKICAgICAgICB0aGlzLiRyZWZzLnVwbG9hZEJ0bi4kZWwuY2xpY2soKQogICAgICB9KQogICAgICAvLyDnm5HlkKzlhoXlrrnlj5jljJbvvIzliqjmgIHotYvlgLwKICAgICAgdGhpcy5xdWlsbEVkaXRvci5vbigndGV4dC1jaGFuZ2UnLCAoKSA9PiB7CiAgICAgICAgdGhpcy5kYXRhRm9ybS5jb250ZW50ID0gdGhpcy5xdWlsbEVkaXRvci5yb290LmlubmVySFRNTAogICAgICB9KQogICAgfSwKICAgIC8vIOS4iuS8oOWbvueJh+S5i+WJjQogICAgdXBsb2FkQmVmb3JlVXBsb2FkSGFuZGxlIChmaWxlKSB7CiAgICAgIGlmIChmaWxlLnR5cGUgIT09ICdpbWFnZS9qcGcnICYmIGZpbGUudHlwZSAhPT0gJ2ltYWdlL2pwZWcnICYmIGZpbGUudHlwZSAhPT0gJ2ltYWdlL3BuZycgJiYgZmlsZS50eXBlICE9PSAnaW1hZ2UvZ2lmJykgewogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IodGhpcy4kdCgndXBsb2FkLnRpcCcsIHsgJ2Zvcm1hdCc6ICdqcGfjgIFwbmfjgIFnaWYnIH0pKQogICAgICAgIHJldHVybiBmYWxzZQogICAgICB9CiAgICB9LAogICAgLy8g5LiK5Lyg5Zu+54mH5oiQ5YqfCiAgICB1cGxvYWRTdWNjZXNzSGFuZGxlIChyZXMsIGZpbGUsIGZpbGVMaXN0KSB7CiAgICAgIGlmIChyZXMuY29kZSAhPT0gMCkgewogICAgICAgIHJldHVybiB0aGlzLiRtZXNzYWdlLmVycm9yKHJlcy5tc2cpCiAgICAgIH0KICAgICAgdGhpcy5xdWlsbEVkaXRvci5pbnNlcnRFbWJlZCh0aGlzLnF1aWxsRWRpdG9yLmdldFNlbGVjdGlvbigpLmluZGV4LCAnaW1hZ2UnLCByZXMuZGF0YS5zcmMpCiAgICB9LAogICAgLy8g6I635Y+W5L+h5oGvCiAgICBnZXRJbmZvICgpIHsKICAgICAgdGhpcy4kaHR0cC5nZXQoYC9zeXMvbWFpbHRlbXBsYXRlLyR7dGhpcy5kYXRhRm9ybS5pZH1gKS50aGVuKCh7IGRhdGE6IHJlcyB9KSA9PiB7CiAgICAgICAgaWYgKHJlcy5jb2RlICE9PSAwKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy4kbWVzc2FnZS5lcnJvcihyZXMubXNnKQogICAgICAgIH0KICAgICAgICB0aGlzLmRhdGFGb3JtID0gcmVzLmRhdGEKICAgICAgICB0aGlzLnF1aWxsRWRpdG9yLnJvb3QuaW5uZXJIVE1MID0gdGhpcy5kYXRhRm9ybS5jb250ZW50CiAgICAgIH0pLmNhdGNoKCgpID0+IHt9KQogICAgfSwKICAgIC8vIOihqOWNleaPkOS6pAogICAgZGF0YUZvcm1TdWJtaXRIYW5kbGU6IGRlYm91bmNlKGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy4kcmVmc1snZGF0YUZvcm0nXS52YWxpZGF0ZSgodmFsaWQpID0+IHsKICAgICAgICBpZiAoIXZhbGlkKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICB9CiAgICAgICAgdGhpcy4kaHR0cFshdGhpcy5kYXRhRm9ybS5pZCA/ICdwb3N0JyA6ICdwdXQnXSgKICAgICAgICAgICcvc3lzL21haWx0ZW1wbGF0ZScsCiAgICAgICAgICB0aGlzLmRhdGFGb3JtLAogICAgICAgICAgeyBoZWFkZXJzOiB7ICdjb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJyB9IH0KICAgICAgICApLnRoZW4oKHsgZGF0YTogcmVzIH0pID0+IHsKICAgICAgICAgIGlmIChyZXMuY29kZSAhPT0gMCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy4kbWVzc2FnZS5lcnJvcihyZXMubXNnKQogICAgICAgICAgfQogICAgICAgICAgdGhpcy4kbWVzc2FnZSh7CiAgICAgICAgICAgIG1lc3NhZ2U6IHRoaXMuJHQoJ3Byb21wdC5zdWNjZXNzJyksCiAgICAgICAgICAgIHR5cGU6ICdzdWNjZXNzJywKICAgICAgICAgICAgZHVyYXRpb246IDUwMCwKICAgICAgICAgICAgb25DbG9zZTogKCkgPT4gewogICAgICAgICAgICAgIHRoaXMudmlzaWJsZSA9IGZhbHNlCiAgICAgICAgICAgICAgdGhpcy4kZW1pdCgncmVmcmVzaERhdGFMaXN0JykKICAgICAgICAgICAgfQogICAgICAgICAgfSkKICAgICAgICB9KS5jYXRjaCgoKSA9PiB7fSkKICAgICAgfSkKICAgIH0sIDEwMDAsIHsgJ2xlYWRpbmcnOiB0cnVlLCAndHJhaWxpbmcnOiBmYWxzZSB9KQogIH0KfQo="},{"version":3,"sources":["mail-template-add-or-update.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"mail-template-add-or-update.vue","sourceRoot":"src/views/modules/message","sourcesContent":["<template>\n  <el-dialog :visible.sync=\"visible\" :title=\"!dataForm.id ? $t('add') : $t('update')\" :close-on-click-modal=\"false\" :close-on-press-escape=\"false\">\n    <el-form :model=\"dataForm\" :rules=\"dataRule\" ref=\"dataForm\" @keyup.enter.native=\"dataFormSubmitHandle()\" label-width=\"120px\">\n      <el-form-item prop=\"name\" :label=\"$t('mail.name')\">\n        <el-input v-model=\"dataForm.name\" :placeholder=\"$t('mail.name')\"></el-input>\n      </el-form-item>\n      <el-form-item prop=\"subject\" :label=\"$t('mail.subject')\">\n        <el-input v-model=\"dataForm.subject\" :placeholder=\"$t('mail.subject')\"></el-input>\n      </el-form-item>\n      <el-form-item prop=\"content\" :label=\"$t('mail.content')\">\n        <!-- 富文本编辑器, 容器 -->\n        <div id=\"J_quillEditor\"></div>\n        <!-- 自定义上传图片功能 (使用element upload组件) -->\n        <el-upload\n          :action=\"uploadUrl\"\n          :show-file-list=\"false\"\n          :before-upload=\"uploadBeforeUploadHandle\"\n          :on-success=\"uploadSuccessHandle\"\n          style=\"display: none;\">\n          <el-button ref=\"uploadBtn\" type=\"primary\" size=\"small\">{{ $t('upload.button') }}</el-button>\n        </el-upload>\n      </el-form-item>\n    </el-form>\n    <template slot=\"footer\">\n      <el-button @click=\"visible = false\">{{ $t('cancel') }}</el-button>\n      <el-button type=\"primary\" @click=\"dataFormSubmitHandle()\">{{ $t('confirm') }}</el-button>\n    </template>\n  </el-dialog>\n</template>\n\n<script>\nimport Cookies from 'js-cookie'\nimport debounce from 'lodash/debounce'\nimport 'quill/dist/quill.snow.css'\nimport Quill from 'quill'\nexport default {\n  data () {\n    return {\n      visible: false,\n      quillEditor: null,\n      quillEditorToolbarOptions: [\n        ['bold', 'italic', 'underline', 'strike'],\n        ['blockquote', 'code-block', 'image'],\n        [{ 'header': 1 }, { 'header': 2 }],\n        [{ 'list': 'ordered' }, { 'list': 'bullet' }],\n        [{ 'script': 'sub' }, { 'script': 'super' }],\n        [{ 'indent': '-1' }, { 'indent': '+1' }],\n        [{ 'direction': 'rtl' }],\n        [{ 'size': ['small', false, 'large', 'huge'] }],\n        [{ 'header': [1, 2, 3, 4, 5, 6, false] }],\n        [{ 'color': [] }, { 'background': [] }],\n        [{ 'font': [] }],\n        [{ 'align': [] }],\n        ['clean']\n      ],\n      uploadUrl: '',\n      dataForm: {\n        id: '',\n        name: '',\n        subject: '',\n        content: ''\n      }\n    }\n  },\n  computed: {\n    dataRule () {\n      var validateContent = (rule, value, callback) => {\n        if (this.quillEditor.getLength() <= 1) {\n          return callback(new Error(this.$t('validate.required')))\n        }\n        callback()\n      }\n      return {\n        name: [\n          { required: true, message: this.$t('validate.required'), trigger: 'blur' }\n        ],\n        subject: [\n          { required: true, message: this.$t('validate.required'), trigger: 'blur' }\n        ],\n        content: [\n          { required: true, message: this.$t('validate.required'), trigger: 'blur' },\n          { validator: validateContent, trigger: 'blur' }\n        ]\n      }\n    }\n  },\n  methods: {\n    init () {\n      this.visible = true\n      this.$nextTick(() => {\n        if (this.quillEditor) {\n          this.quillEditor.deleteText(0, this.quillEditor.getLength())\n        } else {\n          this.quillEditorHandle()\n        }\n        this.$refs['dataForm'].resetFields()\n        if (this.dataForm.id) {\n          this.getInfo()\n        }\n      })\n    },\n    // 富文本编辑器\n    quillEditorHandle () {\n      this.quillEditor = new Quill('#J_quillEditor', {\n        modules: {\n          toolbar: this.quillEditorToolbarOptions\n        },\n        theme: 'snow'\n      })\n      // 自定义上传图片功能 (使用element upload组件)\n      this.uploadUrl = `${window.SITE_CONFIG['apiURL']}/sys/oss/upload?token=${Cookies.get('token')}`\n      this.quillEditor.getModule('toolbar').addHandler('image', () => {\n        this.$refs.uploadBtn.$el.click()\n      })\n      // 监听内容变化，动态赋值\n      this.quillEditor.on('text-change', () => {\n        this.dataForm.content = this.quillEditor.root.innerHTML\n      })\n    },\n    // 上传图片之前\n    uploadBeforeUploadHandle (file) {\n      if (file.type !== 'image/jpg' && file.type !== 'image/jpeg' && file.type !== 'image/png' && file.type !== 'image/gif') {\n        this.$message.error(this.$t('upload.tip', { 'format': 'jpg、png、gif' }))\n        return false\n      }\n    },\n    // 上传图片成功\n    uploadSuccessHandle (res, file, fileList) {\n      if (res.code !== 0) {\n        return this.$message.error(res.msg)\n      }\n      this.quillEditor.insertEmbed(this.quillEditor.getSelection().index, 'image', res.data.src)\n    },\n    // 获取信息\n    getInfo () {\n      this.$http.get(`/sys/mailtemplate/${this.dataForm.id}`).then(({ data: res }) => {\n        if (res.code !== 0) {\n          return this.$message.error(res.msg)\n        }\n        this.dataForm = res.data\n        this.quillEditor.root.innerHTML = this.dataForm.content\n      }).catch(() => {})\n    },\n    // 表单提交\n    dataFormSubmitHandle: debounce(function () {\n      this.$refs['dataForm'].validate((valid) => {\n        if (!valid) {\n          return false\n        }\n        this.$http[!this.dataForm.id ? 'post' : 'put'](\n          '/sys/mailtemplate',\n          this.dataForm,\n          { headers: { 'content-type': 'application/x-www-form-urlencoded' } }\n        ).then(({ data: res }) => {\n          if (res.code !== 0) {\n            return this.$message.error(res.msg)\n          }\n          this.$message({\n            message: this.$t('prompt.success'),\n            type: 'success',\n            duration: 500,\n            onClose: () => {\n              this.visible = false\n              this.$emit('refreshDataList')\n            }\n          })\n        }).catch(() => {})\n      })\n    }, 1000, { 'leading': true, 'trailing': false })\n  }\n}\n</script>\n"]}]}