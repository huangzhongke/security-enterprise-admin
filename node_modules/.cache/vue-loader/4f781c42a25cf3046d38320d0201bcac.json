{"remainingRequest":"E:\\frontCode\\security-enterprise-admin\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\frontCode\\security-enterprise-admin\\src\\components\\ren-process-start\\src\\ren-process-start.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\frontCode\\security-enterprise-admin\\src\\components\\ren-process-start\\src\\ren-process-start.vue","mtime":1657251814287},{"path":"E:\\frontCode\\security-enterprise-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1657251795729},{"path":"E:\\frontCode\\security-enterprise-admin\\node_modules\\babel-loader\\lib\\index.js","mtime":1657251794312},{"path":"E:\\frontCode\\security-enterprise-admin\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1657251795729},{"path":"E:\\frontCode\\security-enterprise-admin\\node_modules\\vue-loader\\lib\\index.js","mtime":1657251812566}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KDQppbXBvcnQgcXMgZnJvbSAncXMnDQpleHBvcnQgZGVmYXVsdCB7DQogIG5hbWU6ICdSZW5Qcm9jZXNzU3RhcnQnLA0KICBkYXRhICgpIHsNCiAgICByZXR1cm4gew0KICAgICAgZm9ybVVybDogJycsDQogICAgICBpbnN0YW5jZUlkVXJsOiAnJywNCiAgICAgIGZvcm1OYW1lOiBudWxsLA0KICAgICAgcm9vdE9iajogbnVsbCwNCiAgICAgIGRhdGFGb3JtOiB7DQogICAgICAgIHByb2Nlc3NEZWZpbml0aW9uS2V5OiAnJw0KICAgICAgfSwNCiAgICAgIC8vIOWbnuiwg+WHveaVsA0KICAgICAgY2FsbGJhY2tzOiB7DQogICAgICAgIHN0YXJ0UHJvY2Vzc1N1Y2Nlc3NDYWxsYmFjazogbnVsbCwNCiAgICAgICAgc3RhcnRQcm9jZXNzRXJyb3JDYWxsYmFjazogbnVsbCwNCiAgICAgICAgZm9ybVNhdmVTdWNjZXNzQ2FsbGJhY2s6IG51bGwsDQogICAgICAgIGZvcm1TYXZlRXJyb3JDYWxsYmFjazogbnVsbA0KICAgICAgfQ0KICAgIH0NCiAgfSwNCiAgY29tcG9uZW50czogew0KICB9LA0KICBjcmVhdGVkICgpIHsNCiAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7DQogICAgICB0aGlzLmZvcm1VcmwgPSB0aGlzLnNhdmVGb3JtVXJsDQogICAgICB0aGlzLmluc3RhbmNlSWRVcmwgPSB0aGlzLnVwZGF0ZUluc3RhbmNlSWRVcmwNCiAgICAgIHRoaXMuZm9ybU5hbWUgPSB0aGlzLmRhdGFGb3JtTmFtZQ0KICAgIH0pDQogIH0sDQogIHByb3BzOiB7DQogICAgc2F2ZUZvcm1Vcmw6IFN0cmluZywNCiAgICB1cGRhdGVJbnN0YW5jZUlkVXJsOiBTdHJpbmcsDQogICAgZGF0YUZvcm1OYW1lOiBTdHJpbmcNCiAgfSwNCiAgd2F0Y2g6IHsNCiAgICBzYXZlRm9ybVVybCAodmFsKSB7DQogICAgICB0aGlzLmZvcm1VcmwgPSB2YWwNCiAgICB9LA0KICAgIHVwZGF0ZUluc3RhbmNlSWRVcmwgKHZhbCkgew0KICAgICAgdGhpcy5pbnN0YW5jZUlkVXJsID0gdmFsDQogICAgfSwNCiAgICBkYXRhRm9ybU5hbWUgKHZhbCkgew0KICAgICAgdGhpcy5mb3JtTmFtZSA9IHZhbA0KICAgIH0NCiAgfSwNCiAgbWV0aG9kczogew0KICAgIC8vIOWQr+WKqOa1geeoi+S6i+S7tg0KICAgIHByb2Nlc3NTdGFydEhhbmRsZSAoKSB7DQogICAgICBpZiAoIXRoaXMuZm9ybVVybCkgew0KICAgICAgICByZXR1cm4gdGhpcy4kbWVzc2FnZS5lcnJvcih0aGlzLiR0KCdwcm9jZXNzLmZvcm1VUkxFcnJvcicpKQ0KICAgICAgfQ0KICAgICAgaWYgKCF0aGlzLmRhdGFGb3JtLnByb2Nlc3NEZWZpbml0aW9uS2V5KSB7DQogICAgICAgIHJldHVybiB0aGlzLiRtZXNzYWdlLmVycm9yKHRoaXMuJHQoJ3Byb2Nlc3Mua2V5RXJyb3InKSkNCiAgICAgIH0NCiAgICAgIGlmICghdGhpcy5mb3JtTmFtZSkgew0KICAgICAgICByZXR1cm4gdGhpcy4kbWVzc2FnZS5lcnJvcih0aGlzLiR0KCdwcm9jZXNzLmZvcm1OYW1lRXJyb3InKSkNCiAgICAgIH0NCiAgICAgIHRoaXMucm9vdE9iai4kcmVmc1t0aGlzLmZvcm1OYW1lXS52YWxpZGF0ZSgodmFsaWQpID0+IHsNCiAgICAgICAgaWYgKCF2YWxpZCkgew0KICAgICAgICAgIHJldHVybiBmYWxzZQ0KICAgICAgICB9DQogICAgICAgIHRoaXMuJGh0dHAuZ2V0KGAvYWN0L3Byb2Nlc3MvbGFzdGVzdFBhZ2VgLCB7DQogICAgICAgICAgcGFyYW1zOiB7DQogICAgICAgICAgICBrZXk6IHRoaXMuZGF0YUZvcm0ucHJvY2Vzc0RlZmluaXRpb25LZXkNCiAgICAgICAgICB9DQogICAgICAgIH0pLnRoZW4oKHsgZGF0YTogcmVzIH0pID0+IHsNCiAgICAgICAgICBpZiAocmVzLmNvZGUgIT09IDApIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLiRtZXNzYWdlLmVycm9yKHJlcy5tc2cpDQogICAgICAgICAgfQ0KICAgICAgICAgIGlmICghcmVzLmRhdGEubGlzdCB8fCByZXMuZGF0YS5saXN0Lmxlbmd0aCA8PSAwKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy4kbWVzc2FnZS5lcnJvcih0aGlzLiR0KCdwcm9jZXNzLm5vdEV4aXN0RXJyb3InKSkNCiAgICAgICAgICB9DQogICAgICAgICAgdGhpcy4kaHR0cFsncG9zdCddKHRoaXMuZm9ybVVybCwgdGhpcy5yb290T2JqW3RoaXMuZm9ybU5hbWVdKS50aGVuKCh7IGRhdGE6IHJlcyB9KSA9PiB7DQogICAgICAgICAgICBpZiAocmVzLmNvZGUgIT09IDApIHsNCiAgICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihyZXMubXNnKQ0KICAgICAgICAgICAgICBpZiAodGhpcy5jYWxsYmFja3MuZm9ybVNhdmVFcnJvckNhbGxiYWNrKSB7DQogICAgICAgICAgICAgICAgdGhpcy5jYWxsYmFja3MuZm9ybVNhdmVFcnJvckNhbGxiYWNrKHJlcykNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKHRoaXMuY2FsbGJhY2tzLmZvcm1TYXZlU3VjY2Vzc0NhbGxiYWNrKSB7DQogICAgICAgICAgICAgIHRoaXMuY2FsbGJhY2tzLmZvcm1TYXZlU3VjY2Vzc0NhbGxiYWNrKHJlcykNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICghcmVzLmRhdGEuYnVzaW5lc3NLZXkpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJG1lc3NhZ2UuZXJyb3IodGhpcy4kdCgncHJvY2Vzcy5idXNpbmVzc0tleUVycm9yJykpDQogICAgICAgICAgICAgIC8vIHRoaXMuc3RhcnRQcm9jZXNzKHRoaXMuZGF0YUZvcm0ucHJvY2Vzc0RlZmluaXRpb25LZXksIG51bGwsIHRoaXMucm9vdE9ialt0aGlzLmZvcm1OYW1lXSkNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIHRoaXMuc3RhcnRQcm9jZXNzKHRoaXMuZGF0YUZvcm0ucHJvY2Vzc0RlZmluaXRpb25LZXksIHJlcy5kYXRhLmJ1c2luZXNzS2V5LCB0aGlzLnJvb3RPYmpbdGhpcy5mb3JtTmFtZV0pDQogICAgICAgICAgICB9DQogICAgICAgICAgfSkuY2F0Y2goKCkgPT4ge30pDQogICAgICAgIH0pLmNhdGNoKCgpID0+IHt9KQ0KICAgICAgfSkNCiAgICB9LA0KICAgIC8vIOWQr+WKqOa1geeoiw0KICAgIHN0YXJ0UHJvY2VzcyAocHJvY2Vzc0RlZmluaXRpb25LZXksIGJ1c2luZXNzS2V5LCBmb3JtRGF0YSkgew0KICAgICAgdmFyIGRhdGEgPSB7DQogICAgICAgIHByb2Nlc3NEZWZpbml0aW9uS2V5OiBwcm9jZXNzRGVmaW5pdGlvbktleSwNCiAgICAgICAgYnVzaW5lc3NLZXk6IGJ1c2luZXNzS2V5LA0KICAgICAgICB2YXJpYWJsZXM6IGZvcm1EYXRhDQogICAgICB9DQogICAgICB0aGlzLiRodHRwWydwb3N0J10oJy9hY3QvcnVubmluZy9zdGFydE9mQnVzaW5lc3NLZXknLCBkYXRhKS50aGVuKCh7IGRhdGE6IHJlcyB9KSA9PiB7DQogICAgICAgIGlmIChyZXMuY29kZSAhPT0gMCkgew0KICAgICAgICAgIGlmICh0aGlzLmNhbGxiYWNrcy5zdGFydFByb2Nlc3NFcnJvckNhbGxiYWNrKSB7DQogICAgICAgICAgICB0aGlzLmNhbGxiYWNrcy5zdGFydFByb2Nlc3NFcnJvckNhbGxiYWNrKHJlcy5kYXRhKQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICB0aGlzLiRtZXNzYWdlKHsNCiAgICAgICAgICBtZXNzYWdlOiB0aGlzLiR0KCdwcm9tcHQuc3VjY2VzcycpLA0KICAgICAgICAgIHR5cGU6ICdzdWNjZXNzJywNCiAgICAgICAgICBkdXJhdGlvbjogNTAwLA0KICAgICAgICAgIG9uQ2xvc2U6ICgpID0+IHsNCiAgICAgICAgICAgIGlmICh0aGlzLmNhbGxiYWNrcy5zdGFydFByb2Nlc3NTdWNjZXNzQ2FsbGJhY2spIHsNCiAgICAgICAgICAgICAgdGhpcy5jYWxsYmFja3Muc3RhcnRQcm9jZXNzU3VjY2Vzc0NhbGxiYWNrKHJlcy5kYXRhKQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfSkNCiAgICAgICAgaWYgKHRoaXMuaW5zdGFuY2VJZFVybCkgew0KICAgICAgICAgIHZhciBwYXJhbXMgPSBxcy5zdHJpbmdpZnkoew0KICAgICAgICAgICAgcHJvY2Vzc0luc3RhbmNlSWQ6IHJlcy5kYXRhLnByb2Nlc3NJbnN0YW5jZUlkLA0KICAgICAgICAgICAgcHJvY2Vzc0RlZmluaXRpb25LZXk6IHByb2Nlc3NEZWZpbml0aW9uS2V5LA0KICAgICAgICAgICAgYnVzaW5lc3NLZXk6IGJ1c2luZXNzS2V5DQogICAgICAgICAgfSkNCiAgICAgICAgICB0aGlzLiRodHRwWydwb3N0J10odGhpcy5pbnN0YW5jZUlkVXJsICsgJz8nICsgcGFyYW1zKS50aGVuKCh7IGRhdGE6IHJlcyB9KSA9PiB7fSkNCiAgICAgICAgfQ0KICAgICAgfSkuY2F0Y2goKCkgPT4ge30pDQogICAgfQ0KICB9DQp9DQo="},{"version":3,"sources":["ren-process-start.vue"],"names":[],"mappings":";;;;;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ren-process-start.vue","sourceRoot":"src/components/ren-process-start/src","sourcesContent":["<template>\r\n  <el-button type=\"primary\" @click=\"processStartHandle()\">{{ $t('process.createInstance') }}</el-button>\r\n</template>\r\n\r\n<script>\r\nimport qs from 'qs'\r\nexport default {\r\n  name: 'RenProcessStart',\r\n  data () {\r\n    return {\r\n      formUrl: '',\r\n      instanceIdUrl: '',\r\n      formName: null,\r\n      rootObj: null,\r\n      dataForm: {\r\n        processDefinitionKey: ''\r\n      },\r\n      // 回调函数\r\n      callbacks: {\r\n        startProcessSuccessCallback: null,\r\n        startProcessErrorCallback: null,\r\n        formSaveSuccessCallback: null,\r\n        formSaveErrorCallback: null\r\n      }\r\n    }\r\n  },\r\n  components: {\r\n  },\r\n  created () {\r\n    this.$nextTick(() => {\r\n      this.formUrl = this.saveFormUrl\r\n      this.instanceIdUrl = this.updateInstanceIdUrl\r\n      this.formName = this.dataFormName\r\n    })\r\n  },\r\n  props: {\r\n    saveFormUrl: String,\r\n    updateInstanceIdUrl: String,\r\n    dataFormName: String\r\n  },\r\n  watch: {\r\n    saveFormUrl (val) {\r\n      this.formUrl = val\r\n    },\r\n    updateInstanceIdUrl (val) {\r\n      this.instanceIdUrl = val\r\n    },\r\n    dataFormName (val) {\r\n      this.formName = val\r\n    }\r\n  },\r\n  methods: {\r\n    // 启动流程事件\r\n    processStartHandle () {\r\n      if (!this.formUrl) {\r\n        return this.$message.error(this.$t('process.formURLError'))\r\n      }\r\n      if (!this.dataForm.processDefinitionKey) {\r\n        return this.$message.error(this.$t('process.keyError'))\r\n      }\r\n      if (!this.formName) {\r\n        return this.$message.error(this.$t('process.formNameError'))\r\n      }\r\n      this.rootObj.$refs[this.formName].validate((valid) => {\r\n        if (!valid) {\r\n          return false\r\n        }\r\n        this.$http.get(`/act/process/lastestPage`, {\r\n          params: {\r\n            key: this.dataForm.processDefinitionKey\r\n          }\r\n        }).then(({ data: res }) => {\r\n          if (res.code !== 0) {\r\n            return this.$message.error(res.msg)\r\n          }\r\n          if (!res.data.list || res.data.list.length <= 0) {\r\n            return this.$message.error(this.$t('process.notExistError'))\r\n          }\r\n          this.$http['post'](this.formUrl, this.rootObj[this.formName]).then(({ data: res }) => {\r\n            if (res.code !== 0) {\r\n              this.$message.error(res.msg)\r\n              if (this.callbacks.formSaveErrorCallback) {\r\n                this.callbacks.formSaveErrorCallback(res)\r\n              }\r\n            }\r\n            if (this.callbacks.formSaveSuccessCallback) {\r\n              this.callbacks.formSaveSuccessCallback(res)\r\n            }\r\n            if (!res.data.businessKey) {\r\n              return this.$message.error(this.$t('process.businessKeyError'))\r\n              // this.startProcess(this.dataForm.processDefinitionKey, null, this.rootObj[this.formName])\r\n            } else {\r\n              this.startProcess(this.dataForm.processDefinitionKey, res.data.businessKey, this.rootObj[this.formName])\r\n            }\r\n          }).catch(() => {})\r\n        }).catch(() => {})\r\n      })\r\n    },\r\n    // 启动流程\r\n    startProcess (processDefinitionKey, businessKey, formData) {\r\n      var data = {\r\n        processDefinitionKey: processDefinitionKey,\r\n        businessKey: businessKey,\r\n        variables: formData\r\n      }\r\n      this.$http['post']('/act/running/startOfBusinessKey', data).then(({ data: res }) => {\r\n        if (res.code !== 0) {\r\n          if (this.callbacks.startProcessErrorCallback) {\r\n            this.callbacks.startProcessErrorCallback(res.data)\r\n          }\r\n        }\r\n        this.$message({\r\n          message: this.$t('prompt.success'),\r\n          type: 'success',\r\n          duration: 500,\r\n          onClose: () => {\r\n            if (this.callbacks.startProcessSuccessCallback) {\r\n              this.callbacks.startProcessSuccessCallback(res.data)\r\n            }\r\n          }\r\n        })\r\n        if (this.instanceIdUrl) {\r\n          var params = qs.stringify({\r\n            processInstanceId: res.data.processInstanceId,\r\n            processDefinitionKey: processDefinitionKey,\r\n            businessKey: businessKey\r\n          })\r\n          this.$http['post'](this.instanceIdUrl + '?' + params).then(({ data: res }) => {})\r\n        }\r\n      }).catch(() => {})\r\n    }\r\n  }\r\n}\r\n</script>\r\n"]}]}